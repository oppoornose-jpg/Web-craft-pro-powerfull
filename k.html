<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WebCraft AI Pro - Universal Builder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --primary: #6366f1; --primary-dark: #4f46e5; --secondary: #ec4899; --success: #10b981;
            --warning: #f59e0b; --danger: #ef4444; --info: #3b82f6; --dark: #0f172a;
            --dark-light: #1e293b; --dark-lighter: #334155; --light: #f8fafc;
            --gray: #94a3b8; --border: rgba(148, 163, 184, 0.2);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --radius: 12px; --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --ai-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --block-event: #f59e0b; --block-action: #10b981; --block-logic: #3b82f6;
            --block-data: #8b5cf6; --block-api: #ec4899; --block-anim: #06b6d4;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark); color: var(--light); height: 100vh; overflow: hidden;
            transition: var(--transition);
        }

        .light-mode { --bg: #ffffff; --bg-secondary: #f1f5f9; --text: #0f172a; }

        /* App Container */
        .app { display: flex; flex-direction: column; height: 100vh; }

        /* Header */
        .header {
            height: 60px; background: var(--dark-light); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            z-index: 1000;
        }

        .logo {
            display: flex; align-items: center; gap: 12px; font-size: 20px; font-weight: 700;
            background: var(--ai-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .header-actions { display: flex; gap: 10px; align-items: center; }

        .icon-btn {
            width: 40px; height: 40px; border-radius: 10px; border: none;
            background: var(--dark-lighter); color: var(--light); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: var(--transition); font-size: 16px; position: relative;
        }

        .icon-btn:hover, .icon-btn.active { background: var(--primary); transform: translateY(-2px); }
        .icon-btn.ai-btn { background: var(--ai-gradient); color: white; width: auto; padding: 0 20px; }
        .icon-btn.ai-btn i { margin-right: 8px; }

        /* Main Layout */
        .main { flex: 1; display: flex; overflow: hidden; position: relative; }

        /* Sidebar Left */
        .sidebar-left {
            width: 320px; background: var(--dark-light); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; transition: var(--transition);
        }

        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }

        .ai-panel {
            background: var(--ai-gradient); border-radius: var(--radius); padding: 15px;
            margin-bottom: 15px; display: none;
        }

        .ai-panel.active { display: block; }

        .ai-input {
            width: 100%; padding: 12px; border-radius: 8px; border: none;
            background: rgba(255,255,255,0.9); color: var(--dark); font-size: 14px;
            margin-bottom: 10px;
        }

        .ai-btn-action {
            width: 100%; padding: 10px; background: var(--dark); color: white;
            border: none; border-radius: 6px; cursor: pointer; font-size: 13px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        .ai-examples {
            margin-top: 10px; font-size: 11px; color: rgba(255,255,255,0.8);
        }

        .tabs { display: flex; gap: 5px; overflow-x: auto; padding: 0 20px; margin-top: 15px; }

        .tab {
            padding: 8px 16px; border-radius: 20px; border: none; background: transparent;
            color: var(--gray); cursor: pointer; white-space: nowrap; font-size: 13px;
            transition: var(--transition);
        }

        .tab.active { background: var(--primary); color: white; }

        .tab-content { flex: 1; overflow-y: auto; padding: 20px; display: none; }

        .tab-content.active { display: block; }

        /* Components Grid */
        .components-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .component-card {
            aspect-ratio: 1; background: var(--dark); border: 2px solid var(--border);
            border-radius: var(--radius); display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 8px; cursor: pointer;
            transition: var(--transition); padding: 10px; position: relative;
        }

        .component-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: var(--shadow); }

        .component-card:active { transform: scale(0.95); }

        .component-icon {
            width: 40px; height: 40px; border-radius: 10px;
            background: var(--ai-gradient); display: flex; align-items: center;
            justify-content: center; color: white; font-size: 18px;
        }

        .component-name { font-size: 11px; color: var(--gray); text-align: center; }

        /* Visual Blocks Panel */
        .blocks-panel { display: none; }
        .blocks-panel.active { display: block; }

        .blocks-category {
            margin-bottom: 20px; background: var(--dark); border-radius: var(--radius);
            overflow: hidden;
        }

        .blocks-header {
            padding: 12px 15px; background: var(--dark-lighter);
            font-size: 12px; font-weight: 600; text-transform: uppercase;
            display: flex; align-items: center; gap: 8px; cursor: pointer;
        }

        .blocks-header.event { border-left: 4px solid var(--block-event); }
        .blocks-header.action { border-left: 4px solid var(--block-action); }
        .blocks-header.logic { border-left: 4px solid var(--block-logic); }
        .blocks-header.data { border-left: 4px solid var(--block-data); }
        .blocks-header.api { border-left: 4px solid var(--block-api); }
        .blocks-header.anim { border-left: 4px solid var(--block-anim); }

        .blocks-list { padding: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }

        .block-item {
            padding: 10px; border-radius: 8px; cursor: grab;
            font-size: 12px; display: flex; align-items: center; gap: 8px;
            transition: var(--transition); border: 2px solid transparent;
        }

        .block-item:hover { transform: scale(1.05); }

        .block-item.event { background: rgba(245, 158, 11, 0.2); color: var(--block-event); border-color: var(--block-event); }
        .block-item.action { background: rgba(16, 185, 129, 0.2); color: var(--block-action); border-color: var(--block-action); }
        .block-item.logic { background: rgba(59, 130, 246, 0.2); color: var(--block-logic); border-color: var(--block-logic); }
        .block-item.data { background: rgba(139, 92, 246, 0.2); color: var(--block-data); border-color: var(--block-data); }
        .block-item.api { background: rgba(236, 72, 153, 0.2); color: var(--block-api); border-color: var(--block-api); }
        .block-item.anim { background: rgba(6, 182, 212, 0.2); color: var(--block-anim); border-color: var(--block-anim); }

        /* Canvas Area */
        .canvas-area { flex: 1; display: flex; flex-direction: column; position: relative; }

        .canvas-toolbar {
            height: 50px; background: var(--dark-light); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }

        .device-tabs { display: flex; gap: 5px; background: var(--dark); padding: 4px; border-radius: 8px; }

        .device-tab {
            padding: 6px 12px; border-radius: 6px; border: none; background: transparent;
            color: var(--gray); cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;
        }

        .device-tab.active { background: var(--primary); color: white; }

        .canvas-wrapper {
            flex: 1; overflow: auto; padding: 40px; display: flex; justify-content: center;
            align-items: flex-start; background: radial-gradient(circle at 1px 1px, var(--border) 1px, transparent 0);
            background-size: 20px 20px;
        }

        .canvas {
            background: white; min-height: 800px; width: 100%; max-width: 1200px;
            box-shadow: 0 0 0 1px var(--border), var(--shadow); border-radius: 4px;
            position: relative; transition: var(--transition);
        }

        .canvas.mobile { max-width: 375px; }
        .canvas.tablet { max-width: 768px; }

        .canvas-content { min-height: 100%; padding: 30px; position: relative; }

        .empty-state {
            height: 100%; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: var(--gray); text-align: center; padding: 60px 20px;
        }

        .empty-icon { width: 120px; height: 120px; background: var(--dark-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; margin-bottom: 20px; opacity: 0.5; }

        /* Elements in Canvas */
        .canvas-element {
            position: relative; margin-bottom: 10px; cursor: pointer;
            transition: var(--transition); border: 2px solid transparent;
        }

        .canvas-element:hover { border-color: var(--primary); }

        .canvas-element.selected {
            border-color: var(--primary); z-index: 100;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .canvas-element.selected::before {
            content: attr(data-type); position: absolute; top: -28px; left: -2px;
            background: var(--primary); color: white; padding: 4px 12px;
            border-radius: 4px 4px 0 0; font-size: 11px; font-weight: 600; text-transform: uppercase;
            z-index: 101;
        }

        .element-actions {
            position: absolute; top: -35px; right: 0; display: flex; gap: 5px;
            opacity: 0; transition: var(--transition); z-index: 102;
        }

        .canvas-element.selected .element-actions { opacity: 1; }

        .action-btn {
            width: 28px; height: 28px; border-radius: 6px; border: none;
            background: var(--danger); color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 12px;
        }

        .action-btn.edit { background: var(--info); }
        .action-btn.code { background: var(--success); }
        .action-btn.blocks { background: var(--warning); }

        /* Visual Script Overlay */
        .script-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.95); z-index: 200; display: none;
            padding: 20px; overflow-y: auto;
        }

        .script-overlay.active { display: block; }

        .script-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border);
        }

        .script-title { font-size: 18px; font-weight: 600; }

        .script-workspace {
            min-height: 400px; background: var(--dark); border-radius: var(--radius);
            padding: 20px; position: relative;
        }

        .dropped-blocks { display: flex; flex-direction: column; gap: 10px; }

        .dropped-block {
            padding: 15px; border-radius: 8px; display: flex; align-items: center;
            gap: 10px; cursor: move; position: relative;
        }

        .dropped-block.event { background: var(--block-event); color: white; }
        .dropped-block.action { background: var(--block-action); color: white; }
        .dropped-block.logic { background: var(--block-logic); color: white; }

        .block-config {
            margin-left: auto; display: flex; gap: 10px; align-items: center;
        }

        .block-input {
            padding: 5px 10px; border-radius: 4px; border: none;
            background: rgba(255,255,255,0.2); color: white; font-size: 12px;
        }

        .block-input::placeholder { color: rgba(255,255,255,0.6); }

        /* Properties Panel */
        .sidebar-right {
            width: 380px; background: var(--dark-light); border-left: 1px solid var(--border);
            display: flex; flex-direction: column; overflow-y: auto;
        }

        .panel-section { padding: 20px; border-bottom: 1px solid var(--border); }

        .section-title {
            font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--gray); margin-bottom: 15px; display: flex;
            align-items: center; justify-content: space-between;
        }

        .prop-group { margin-bottom: 16px; }

        .prop-label { font-size: 12px; color: var(--gray); margin-bottom: 6px; display: block; }

        .prop-input {
            width: 100%; padding: 10px 12px; border: 1px solid var(--border);
            border-radius: 8px; background: var(--dark); color: var(--light);
            font-size: 14px; outline: none; transition: var(--transition);
        }

        .prop-input:focus { border-color: var(--primary); }

        .prop-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        .color-input-wrapper { display: flex; align-items: center; gap: 10px; }

        .color-input {
            width: 50px; height: 40px; border: none; border-radius: 8px; cursor: pointer;
        }

        .style-buttons { display: flex; gap: 5px; flex-wrap: wrap; }

        .style-btn {
            padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;
            background: var(--dark); color: var(--light); cursor: pointer;
            font-size: 12px; transition: var(--transition);
        }

        .style-btn:hover, .style-btn.active { border-color: var(--primary); background: var(--primary); color: white; }

        /* Code Editor */
        .code-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark); z-index: 3000; flex-direction: column;
        }

        .code-modal.active { display: flex; }

        .code-header {
            height: 60px; background: var(--dark-light); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }

        .code-tabs { display: flex; gap: 5px; }

        .code-tab {
            padding: 10px 20px; border-radius: 8px; border: none; background: transparent;
            color: var(--gray); cursor: pointer; font-size: 14px;
            display: flex; align-items: center; gap: 8px;
        }

        .code-tab.active { background: var(--primary); color: white; }

        .code-body { flex: 1; display: flex; overflow: hidden; }

        .code-editor-pane { flex: 1; display: flex; flex-direction: column; }

        .CodeMirror {
            flex: 1; background: var(--dark); color: var(--light);
            font-family: 'Fira Code', monospace; font-size: 14px;
        }

        .CodeMirror-gutters { background: var(--dark-lighter); border-right: 1px solid var(--border); }

        .preview-pane {
            flex: 1; background: white; border-left: 1px solid var(--border);
            position: relative;
        }

        .preview-pane iframe { width: 100%; height: 100%; border: none; }

        .preview-controls {
            position: absolute; top: 10px; right: 10px;
            display: flex; gap: 5px;
        }

        .preview-btn {
            padding: 8px 16px; background: var(--dark-light); color: white;
            border: none; border-radius: 6px; cursor: pointer; font-size: 12px;
        }

        /* AI Chat Panel */
        .ai-chat-panel {
            position: fixed; bottom: 80px; right: 20px; width: 400px; max-height: 600px;
            background: var(--dark-light); border: 1px solid var(--border);
            border-radius: var(--radius); box-shadow: var(--shadow);
            display: none; flex-direction: column; z-index: 2500;
        }

        .ai-chat-panel.active { display: flex; }

        .ai-chat-header {
            padding: 15px; background: var(--ai-gradient); color: white;
            border-radius: var(--radius) var(--radius) 0 0; display: flex;
            justify-content: space-between; align-items: center;
        }

        .ai-chat-messages { flex: 1; overflow-y: auto; padding: 15px; max-height: 400px; }

        .ai-message { margin-bottom: 15px; display: flex; gap: 10px; }

        .ai-avatar {
            width: 32px; height: 32px; border-radius: 50%;
            background: var(--ai-gradient); display: flex; align-items: center;
            justify-content: center; color: white; font-size: 14px; flex-shrink: 0;
        }

        .ai-bubble {
            background: var(--dark); padding: 12px; border-radius: 12px;
            font-size: 13px; line-height: 1.5; max-width: 80%;
        }

        .user-message { flex-direction: row-reverse; }

        .user-bubble { background: var(--primary); color: white; }

        .ai-chat-input {
            padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px;
        }

        .ai-chat-input input {
            flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border);
            background: var(--dark); color: var(--light); font-size: 14px;
        }

        .ai-send-btn {
            width: 40px; height: 40px; border-radius: 8px; border: none;
            background: var(--ai-gradient); color: white; cursor: pointer;
        }

        /* Bottom Bar */
        .bottom-bar {
            display: none; height: 70px; background: var(--dark-light);
            border-top: 1px solid var(--border); justify-content: space-around;
            align-items: center; padding: 0 10px; position: fixed;
            bottom: 0; left: 0; right: 0; z-index: 1000;
        }

        .bottom-btn {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            background: none; border: none; color: var(--gray); cursor: pointer;
            font-size: 11px; transition: var(--transition); padding: 5px;
        }

        .bottom-btn i { font-size: 20px; }

        .bottom-btn.active, .bottom-btn:hover { color: var(--primary); }

        .fab {
            width: 56px; height: 56px; border-radius: 50%;
            background: var(--ai-gradient); border: none; color: white;
            font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transform: translateY(-20px); display: flex; align-items: center; justify-content: center;
        }

        .fab:active { transform: translateY(-20px) scale(0.9); }

        /* Modals */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 4000; justify-content: center;
            align-items: center; padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--dark-light); border-radius: var(--radius);
            width: 100%; max-width: 600px; max-height: 90vh;
            overflow: hidden; display: flex; flex-direction: column;
        }

        .modal-header {
            padding: 20px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }

        .modal-title { font-size: 18px; font-weight: 600; }

        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }

        .modal-footer {
            padding: 20px; border-top: 1px solid var(--border);
            display: flex; gap: 10px; justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px; border-radius: 8px; border: none;
            cursor: pointer; font-size: 14px; font-weight: 500;
            transition: var(--transition); display: inline-flex;
            align-items: center; gap: 8px;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--dark-lighter); color: var(--light); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        /* Templates Grid */
        .templates-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }

        .template-card {
            background: var(--dark); border-radius: 12px; overflow: hidden;
            cursor: pointer; transition: var(--transition); border: 2px solid transparent;
        }

        .template-card:hover { border-color: var(--primary); transform: translateY(-3px); }

        .template-preview {
            height: 100px; background: var(--ai-gradient);
            display: flex; align-items: center; justify-content: center; font-size: 36px; color: white;
        }

        .template-info { padding: 15px; }

        .template-name { font-weight: 600; margin-bottom: 5px; }

        .template-desc { font-size: 12px; color: var(--gray); }

        /* Export Options */
        .export-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }

        .export-option {
            background: var(--dark); border: 2px solid var(--border);
            border-radius: 12px; padding: 20px; text-align: center;
            cursor: pointer; transition: var(--transition);
        }

        .export-option:hover { border-color: var(--primary); transform: translateY(-3px); }

        .export-icon {
            width: 50px; height: 50px; background: var(--dark-lighter);
            border-radius: 12px; display: flex; align-items: center;
            justify-content: center; margin: 0 auto 10px; font-size: 24px; color: var(--primary);
        }

        /* QR Code */
        .qr-container {
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }

        #qrcode { margin: 20px 0; }

        /* Toast */
        .toast-container {
            position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%);
            z-index: 5000; display: flex; flex-direction: column; gap: 10px;
        }

        .toast {
            background: var(--dark-light); color: var(--light); padding: 12px 24px;
            border-radius: 8px; box-shadow: var(--shadow); display: flex;
            align-items: center; gap: 10px; font-size: 14px;
            animation: slideUp 0.3s ease; border-left: 4px solid var(--primary);
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Context Menu */
        .context-menu {
            position: fixed; background: var(--dark-light); border: 1px solid var(--border);
            border-radius: 8px; padding: 8px 0; min-width: 200px;
            box-shadow: var(--shadow); z-index: 6000; display: none;
        }

        .context-item {
            padding: 10px 16px; cursor: pointer; display: flex;
            align-items: center; gap: 10px; font-size: 14px; transition: var(--transition);
        }

        .context-item:hover { background: var(--dark-lighter); }

        .context-divider { height: 1px; background: var(--border); margin: 8px 0; }

        /* Animations */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .loading { animation: pulse 1.5s infinite; }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar-left { width: 280px; }
            .sidebar-right { width: 320px; }
        }

        @media (max-width: 768px) {
            .sidebar-left, .sidebar-right {
                display: none; position: fixed; top: 60px; left: 0;
                width: 100%; height: calc(100% - 130px); z-index: 50;
            }

            .sidebar-left.active, .sidebar-right.active { display: flex; }

            .sidebar-right { left: auto; right: 0; }

            .bottom-bar { display: flex; }

            .header-actions { display: none; }

            .mobile-actions { display: flex; gap: 10px; }

            .ai-chat-panel { width: calc(100% - 40px); right: 20px; left: 20px; }

            .code-body { flex-direction: column; }

            .preview-pane { border-left: none; border-top: 1px solid var(--border); height: 50%; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }

        ::-webkit-scrollbar-track { background: var(--dark); }

        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

        ::-webkit-scrollbar-thumb:hover { background: var(--gray); }

        /* Utility Classes */
        .hidden { display: none !important; }

        .flex { display: flex; }

        .flex-col { flex-direction: column; }

        .items-center { align-items: center; }

        .justify-center { justify-content: center; }

        .gap-2 { gap: 8px; }

        .gap-4 { gap: 16px; }

        .p-4 { padding: 16px; }

        .m-4 { margin: 16px; }

        .rounded { border-radius: var(--radius); }

        .text-sm { font-size: 14px; }

        .text-xs { font-size: 12px; }

        .font-bold { font-weight: 700; }

        .text-gray { color: var(--gray); }

        .bg-dark { background: var(--dark); }

        .border { border: 1px solid var(--border); }

        /* Dragging States */
        .dragging { opacity: 0.5; }

        .drag-over { border: 2px dashed var(--primary) !important; background: rgba(99, 102, 241, 0.1); }

        /* Block Connection Lines */
        .block-connector {
            width: 2px; height: 20px; background: var(--gray);
            margin-left: 20px; position: relative;
        }

        .block-connector::after {
            content: ''; position: absolute; bottom: -4px; left: -3px;
            width: 8px; height: 8px; border-radius: 50%; background: var(--gray);
        }

        /* Live Preview Badge */
        .live-badge {
            position: absolute; top: 10px; left: 10px;
            background: var(--danger); color: white; padding: 4px 12px;
            border-radius: 20px; font-size: 11px; font-weight: 600;
            display: flex; align-items: center; gap: 6px;
        }

        .live-badge::before {
            content: ''; width: 6px; height: 6px; background: white;
            border-radius: 50%; animation: pulse 1s infinite;
        }

        /* Element Hover Info */
        .hover-info {
            position: fixed; background: var(--dark-light); color: var(--light);
            padding: 8px 12px; border-radius: 6px; font-size: 12px;
            pointer-events: none; z-index: 7000; display: none;
            border: 1px solid var(--border);
        }

        /* Quick Actions Bar */
        .quick-actions {
            position: fixed; bottom: 100px; right: 20px;
            display: flex; flex-direction: column; gap: 10px; z-index: 100;
        }

        .quick-btn {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--dark-light); border: 1px solid var(--border);
            color: var(--light); cursor: pointer; display: flex;
            align-items: center; justify-content: center;
            font-size: 18px; transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .quick-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }

        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 8000; display: none;
            justify-content: center; align-items: center; padding: 20px;
        }

        .tutorial-overlay.active { display: flex; }

        .tutorial-card {
            background: var(--dark-light); border-radius: var(--radius);
            max-width: 500px; width: 100%; padding: 30px; text-align: center;
        }

        .tutorial-icon {
            width: 80px; height: 80px; background: var(--ai-gradient);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; margin: 0 auto 20px; font-size: 36px; color: white;
        }

        /* Stats Bar */
        .stats-bar {
            position: fixed; bottom: 0; left: 320px; right: 380px;
            height: 30px; background: var(--dark-light); border-top: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-around;
            font-size: 11px; color: var(--gray); z-index: 90;
        }

        @media (max-width: 768px) {
            .stats-bar { left: 0; right: 0; bottom: 70px; }
        }
    </style>
</head>
<body>
    <!-- App -->
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-cube"></i>
                <span>WebCraft AI Pro</span>
            </div>
            
            <div class="header-actions">
                <button class="icon-btn ai-btn" onclick="toggleAIChat()">
                    <i class="fas fa-robot"></i> AI Assistant
                </button>
                <button class="icon-btn" onclick="undo()" title="Undo">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="icon-btn" onclick="redo()" title="Redo">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="icon-btn" onclick="toggleTheme()" title="Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="icon-btn" onclick="openCodeEditor()" title="Code">
                    <i class="fas fa-code"></i>
                </button>
                <button class="icon-btn success" onclick="openExportModal()" title="Export">
                    <i class="fas fa-download"></i>
                </button>
                <button class="icon-btn" onclick="togglePreviewMode()" title="Preview">
                    <i class="fas fa-eye"></i>
                </button>
            </div>

            <div class="mobile-actions" style="display:none;">
                <button class="icon-btn" onclick="toggleSidebarLeft()">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="icon-btn" onclick="toggleSidebarRight()">
                    <i class="fas fa-sliders-h"></i>
                </button>
            </div>
        </header>

        <!-- Main -->
        <div class="main">
            <!-- Sidebar Left -->
            <aside class="sidebar-left" id="sidebarLeft">
                <div class="sidebar-header">
                    <!-- AI Panel -->
                    <div class="ai-panel active" id="aiPanel">
                        <input type="text" class="ai-input" id="aiInput" 
                               placeholder="Say: 'Create todo app' or 'أنشئ تطبيق مهام'" 
                               onkeypress="if(event.key==='Enter')processAICommand()">
                        <button class="ai-btn-action" onclick="processAICommand()">
                            <i class="fas fa-magic"></i> Generate App
                        </button>
                        <div class="ai-examples">
                            Try: "login form", "متجر إلكتروني", "dashboard", "مدونة", "portfolio"
                        </div>
                    </div>

                    <input type="text" class="prop-input" style="margin-top:10px;" 
                           placeholder="Search components..." onkeyup="searchComponents(this.value)">

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('components')">UI</button>
                        <button class="tab" onclick="switchTab('blocks')">Blocks</button>
                        <button class="tab" onclick="switchTab('templates')">Templates</button>
                        <button class="tab" onclick="switchTab('assets')">Assets</button>
                    </div>
                </div>

                <!-- Components Tab -->
                <div class="tab-content active" id="componentsTab">
                    <div class="components-grid" id="componentsGrid"></div>
                </div>

                <!-- Visual Blocks Tab -->
                <div class="tab-content" id="blocksTab">
                    <div class="blocks-panel active">
                        <!-- Event Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header event" onclick="toggleBlocks('event')">
                                <i class="fas fa-bolt"></i> Events <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="eventBlocks">
                                <div class="block-item event" draggable="true" data-block="onClick" data-type="event">
                                    <i class="fas fa-hand-pointer"></i> When Clicked
                                </div>
                                <div class="block-item event" draggable="true" data-block="onLoad" data-type="event">
                                    <i class="fas fa-spinner"></i> When Page Loads
                                </div>
                                <div class="block-item event" draggable="true" data-block="onHover" data-type="event">
                                    <i class="fas fa-mouse"></i> When Hovered
                                </div>
                                <div class="block-item event" draggable="true" data-block="onChange" data-type="event">
                                    <i class="fas fa-edit"></i> When Changed
                                </div>
                                <div class="block-item event" draggable="true" data-block="onSubmit" data-type="event">
                                    <i class="fas fa-paper-plane"></i> When Submitted
                                </div>
                                <div class="block-item event" draggable="true" data-block="onKeyPress" data-type="event">
                                    <i class="fas fa-keyboard"></i> When Key Pressed
                                </div>
                            </div>
                        </div>

                        <!-- Action Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header action" onclick="toggleBlocks('action')">
                                <i class="fas fa-play"></i> Actions <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="actionBlocks">
                                <div class="block-item action" draggable="true" data-block="showAlert" data-type="action">
                                    <i class="fas fa-bell"></i> Show Alert
                                </div>
                                <div class="block-item action" draggable="true" data-block="showModal" data-type="action">
                                    <i class="fas fa-window-restore"></i> Show Modal
                                </div>
                                <div class="block-item action" draggable="true" data-block="hideElement" data-type="action">
                                    <i class="fas fa-eye-slash"></i> Hide Element
                                </div>
                                <div class="block-item action" draggable="true" data-block="showElement" data-type="action">
                                    <i class="fas fa-eye"></i> Show Element
                                </div>
                                <div class="block-item action" draggable="true" data-block="addClass" data-type="action">
                                    <i class="fas fa-plus-circle"></i> Add Class
                                </div>
                                <div class="block-item action" draggable="true" data-block="removeClass" data-type="action">
                                    <i class="fas fa-minus-circle"></i> Remove Class
                                </div>
                                <div class="block-item action" draggable="true" data-block="setText" data-type="action">
                                    <i class="fas fa-font"></i> Set Text
                                </div>
                                <div class="block-item action" draggable="true" data-block="setHTML" data-type="action">
                                    <i class="fas fa-code"></i> Set HTML
                                </div>
                                <div class="block-item action" draggable="true" data-block="redirect" data-type="action">
                                    <i class="fas fa-external-link-alt"></i> Go to URL
                                </div>
                                <div class="block-item action" draggable="true" data-block="scrollTo" data-type="action">
                                    <i class="fas fa-arrow-down"></i> Scroll To
                                </div>
                            </div>
                        </div>

                        <!-- Logic Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header logic" onclick="toggleBlocks('logic')">
                                <i class="fas fa-brain"></i> Logic <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="logicBlocks">
                                <div class="block-item logic" draggable="true" data-block="if" data-type="logic">
                                    <i class="fas fa-code-branch"></i> If Condition
                                </div>
                                <div class="block-item logic" draggable="true" data-block="ifElse" data-type="logic">
                                    <i class="fas fa-code-branch"></i> If Else
                                </div>
                                <div class="block-item logic" draggable="true" data-block="repeat" data-type="logic">
                                    <i class="fas fa-redo"></i> Repeat
                                </div>
                                <div class="block-item logic" draggable="true" data-block="while" data-type="logic">
                                    <i class="fas fa-infinity"></i> While Loop
                                </div>
                                <div class="block-item logic" draggable="true" data-block="wait" data-type="logic">
                                    <i class="fas fa-clock"></i> Wait Seconds
                                </div>
                                <div class="block-item logic" draggable="true" data-block="and" data-type="logic">
                                    <i class="fas fa-link"></i> And
                                </div>
                                <div class="block-item logic" draggable="true" data-block="or" data-type="logic">
                                    <i class="fas fa-unlink"></i> Or
                                </div>
                            </div>
                        </div>

                        <!-- Data Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header data" onclick="toggleBlocks('data')">
                                <i class="fas fa-database"></i> Data <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="dataBlocks">
                                <div class="block-item data" draggable="true" data-block="setVariable" data-type="data">
                                    <i class="fas fa-variable"></i> Set Variable
                                </div>
                                <div class="block-item data" draggable="true" data-block="getVariable" data-type="data">
                                    <i class="fas fa-dollar-sign"></i> Get Variable
                                </div>
                                <div class="block-item data" draggable="true" data-block="getInput" data-type="data">
                                    <i class="fas fa-keyboard"></i> Get Input Value
                                </div>
                                <div class="block-item data" draggable="true" data-block="saveLocal" data-type="data">
                                    <i class="fas fa-save"></i> Save to Storage
                                </div>
                                <div class="block-item data" draggable="true" data-block="loadLocal" data-type="data">
                                    <i class="fas fa-upload"></i> Load from Storage
                                </div>
                                <div class="block-item data" draggable="true" data-block="setCookie" data-type="data">
                                    <i class="fas fa-cookie"></i> Set Cookie
                                </div>
                                <div class="block-item data" draggable="true" data-block="getCookie" data-type="data">
                                    <i class="fas fa-cookie-bite"></i> Get Cookie
                                </div>
                            </div>
                        </div>

                        <!-- API Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header api" onclick="toggleBlocks('api')">
                                <i class="fas fa-cloud"></i> API & Network <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="apiBlocks">
                                <div class="block-item api" draggable="true" data-block="fetchGet" data-type="api">
                                    <i class="fas fa-download"></i> GET Request
                                </div>
                                <div class="block-item api" draggable="true" data-block="fetchPost" data-type="api">
                                    <i class="fas fa-upload"></i> POST Request
                                </div>
                                <div class="block-item api" draggable="true" data-block="fetchPut" data-type="api">
                                    <i class="fas fa-edit"></i> PUT Request
                                </div>
                                <div class="block-item api" draggable="true" data-block="fetchDelete" data-type="api">
                                    <i class="fas fa-trash"></i> DELETE Request
                                </div>
                                <div class="block-item api" draggable="true" data-block="jsonParse" data-type="api">
                                    <i class="fas fa-code"></i> Parse JSON
                                </div>
                                <div class="block-item api" draggable="true" data-block="jsonStringify" data-type="api">
                                    <i class="fas fa-file-code"></i> Stringify JSON
                                </div>
                            </div>
                        </div>

                        <!-- Animation Blocks -->
                        <div class="blocks-category">
                            <div class="blocks-header anim" onclick="toggleBlocks('anim')">
                                <i class="fas fa-film"></i> Animation <i class="fas fa-chevron-down" style="margin-left:auto;"></i>
                            </div>
                            <div class="blocks-list" id="animBlocks">
                                <div class="block-item anim" draggable="true" data-block="fadeIn" data-type="anim">
                                    <i class="fas fa-sun"></i> Fade In
                                </div>
                                <div class="block-item anim" draggable="true" data-block="fadeOut" data-type="anim">
                                    <i class="fas fa-cloud"></i> Fade Out
                                </div>
                                <div class="block-item anim" draggable="true" data-block="slideUp" data-type="anim">
                                    <i class="fas fa-arrow-up"></i> Slide Up
                                </div>
                                <div class="block-item anim" draggable="true" data-block="slideDown" data-type="anim">
                                    <i class="fas fa-arrow-down"></i> Slide Down
                                </div>
                                <div class="block-item anim" draggable="true" data-block="bounce" data-type="anim">
                                    <i class="fas fa-basketball-ball"></i> Bounce
                                </div>
                                <div class="block-item anim" draggable="true" data-block="shake" data-type="anim">
                                    <i class="fas fa-bell"></i> Shake
                                </div>
                                <div class="block-item anim" draggable="true" data-block="rotate" data-type="anim">
                                    <i class="fas fa-sync"></i> Rotate
                                </div>
                                <div class="block-item anim" draggable="true" data-block="scale" data-type="anim">
                                    <i class="fas fa-expand"></i> Scale
                                </div>
                                <div class="block-item anim" draggable="true" data-block="customAnim" data-type="anim">
                                    <i class="fas fa-magic"></i> Custom Animation
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates Tab -->
                <div class="tab-content" id="templatesTab">
                    <div class="templates-grid" id="templatesGrid"></div>
                </div>

                <!-- Assets Tab -->
                <div class="tab-content" id="assetsTab">
                    <div class="components-grid" id="assetsGrid"></div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <div class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="device-tabs">
                        <button class="device-tab active" onclick="setDevice('desktop')">
                            <i class="fas fa-desktop"></i> Desktop
                        </button>
                        <button class="device-tab" onclick="setDevice('tablet')">
                            <i class="fas fa-tablet-alt"></i> Tablet
                        </button>
                        <button class="device-tab" onclick="setDevice('mobile')">
                            <i class="fas fa-mobile-alt"></i> Mobile
                        </button>
                    </div>
                    <div>
                        <button class="icon-btn" onclick="toggleGrid()" title="Grid">
                            <i class="fas fa-border-all"></i>
                        </button>
                        <button class="icon-btn danger" onclick="clearCanvas()" title="Clear">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="canvas-wrapper" id="canvasWrapper">
                    <div class="canvas desktop" id="canvas">
                        <div class="live-badge" style="display:none;" id="liveBadge">LIVE PREVIEW</div>
                        <div class="canvas-content" id="canvasContent">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-plus-circle"></i>
                                </div>
                                <div class="empty-text">Start Building</div>
                                <div class="empty-subtext">
                                    Tap AI Assistant or + to add components<br>
                                    اسحب العناصر أو استخدم المعالج الذكي
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visual Script Overlay -->
                <div class="script-overlay" id="scriptOverlay">
                    <div class="script-header">
                        <div class="script-title">
                            <i class="fas fa-code"></i> Visual Script: <span id="scriptTarget">Element</span>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="saveScript()">
                                <i class="fas fa-save"></i> Save Script
                            </button>
                            <button class="icon-btn" onclick="closeScriptEditor()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="script-workspace" id="scriptWorkspace">
                        <div class="dropped-blocks" id="droppedBlocks">
                            <div style="text-align:center; color:var(--gray); padding:40px;">
                                <i class="fas fa-hand-pointer" style="font-size:32px; margin-bottom:15px;"></i>
                                <p>Drag blocks here from the left panel<br>اسحب البلوكات من اليسار</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Right - Properties -->
            <aside class="sidebar-right" id="sidebarRight">
                <div class="panel-section">
                    <div class="section-title">
                        Properties
                        <button class="icon-btn" onclick="toggleSidebarRight()" style="display:none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="propertiesContent">
                        <div class="empty-state" style="padding:40px 20px;">
                            <i class="fas fa-mouse-pointer" style="font-size:32px; margin-bottom:10px; opacity:0.5;"></i>
                            <p style="font-size:14px;">Select an element to edit properties<br>اختر عنصر للتعديل</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Bar (Mobile) -->
        <nav class="bottom-bar">
            <button class="bottom-btn active" onclick="showMobileTab('components')">
                <i class="fas fa-cube"></i>
                <span>UI</span>
            </button>
            <button class="bottom-btn" onclick="showMobileTab('blocks')">
                <i class="fas fa-puzzle-piece"></i>
                <span>Blocks</span>
            </button>
            <button class="fab" onclick="showComponentPicker()">
                <i class="fas fa-plus"></i>
            </button>
            <button class="bottom-btn" onclick="showMobileTab('templates')">
                <i class="fas fa-layer-group"></i>
                <span>Templates</span>
            </button>
            <button class="bottom-btn" onclick="toggleMobileProperties()">
                <i class="fas fa-sliders-h"></i>
                <span>Edit</span>
            </button>
        </nav>
    </div>

    <!-- AI Chat Panel -->
    <div class="ai-chat-panel" id="aiChatPanel">
        <div class="ai-chat-header">
            <span><i class="fas fa-robot"></i> AI Assistant</span>
            <button class="icon-btn" onclick="toggleAIChat()" style="background:transparent; color:white;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message">
                <div class="ai-avatar"><i class="fas fa-robot"></i></div>
                <div class="ai-bubble">
                    Hello! I can build apps in any language.<br>
                    مرحباً! أستطيع بناء التطبيقات بأي لغة.<br>
                    Say: "Create a todo app" or "متجر إلكتروني"
                </div>
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="Type in any language..." 
                   onkeypress="if(event.key==='Enter')sendAIMessage()">
            <button class="ai-send-btn" onclick="sendAIMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Component Picker Modal (Mobile) -->
    <div class="modal-overlay" id="componentPickerModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Add Component</span>
                <button class="icon-btn" onclick="closeModal('componentPickerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="components-grid" id="mobileComponentGrid"></div>
            </div>
        </div>
    </div>

    <!-- Code Editor Modal -->
    <div class="code-modal" id="codeEditorModal">
        <div class="code-header">
            <div class="code-tabs">
                <button class="code-tab active" onclick="switchCodeTab('html')">
                    <i class="fab fa-html5"></i> HTML
                </button>
                <button class="code-tab" onclick="switchCodeTab('css')">
                    <i class="fab fa-css3-alt"></i> CSS
                </button>
                <button class="code-tab" onclick="switchCodeTab('js')">
                    <i class="fab fa-js"></i> JavaScript
                </button>
                <button class="code-tab" onclick="switchCodeTab('react')">
                    <i class="fab fa-react"></i> React
                </button>
                <button class="code-tab" onclick="switchCodeTab('vue')">
                    <i class="fab fa-vuejs"></i> Vue
                </button>
                <button class="code-tab" onclick="switchCodeTab('full')">
                    <i class="fas fa-globe"></i> Full Preview
                </button>
            </div>
            <div>
                <button class="btn btn-secondary" onclick="formatCode()">
                    <i class="fas fa-magic"></i> Format
                </button>
                <button class="btn btn-primary" onclick="applyCodeChanges()">
                    <i class="fas fa-check"></i> Apply
                </button>
                <button class="btn btn-secondary" onclick="closeCodeEditor()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="code-body">
            <div class="code-editor-pane" id="editorPane">
                <textarea id="codeTextarea"></textarea>
            </div>
            <div class="preview-pane" id="previewPane">
                <div class="preview-controls">
                    <button class="preview-btn" onclick="refreshPreview()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="preview-btn" onclick="openInNewTab()">
                        <i class="fas fa-external-link-alt"></i> Open in New Tab
                    </button>
                </div>
                <iframe id="previewFrame"></iframe>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Export Project</span>
                <button class="icon-btn" onclick="closeModal('exportModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-grid">
                    <div class="export-option" onclick="exportProject('html')">
                        <div class="export-icon"><i class="fab fa-html5"></i></div>
                        <div>Static HTML</div>
                    </div>
                    <div class="export-option" onclick="exportProject('react')">
                        <div class="export-icon"><i class="fab fa-react"></i></div>
                        <div>React App</div>
                    </div>
                    <div class="export-option" onclick="exportProject('vue')">
                        <div class="export-icon"><i class="fab fa-vuejs"></i></div>
                        <div>Vue App</div>
                    </div>
                    <div class="export-option" onclick="exportProject('next')">
                        <div class="export-icon"><i class="fas fa-n"></i></div>
                        <div>Next.js</div>
                    </div>
                    <div class="export-option" onclick="exportProject('angular')">
                        <div class="export-icon"><i class="fab fa-angular"></i></div>
                        <div>Angular</div>
                    </div>
                    <div class="export-option" onclick="exportProject('svelte')">
                        <div class="export-icon"><i class="fas fa-bolt"></i></div>
                        <div>Svelte</div>
                    </div>
                </div>
                
                <div class="qr-container" style="margin-top:30px;">
                    <h4 style="margin-bottom:15px;">Scan to Preview on Mobile</h4>
                    <div id="qrcode"></div>
                    <p style="color:var(--gray); font-size:12px; margin-top:10px;">
                        Or open: <span id="previewUrl">localhost:3000</span>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('exportModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Preview Mode Overlay -->
    <div class="modal-overlay" id="previewModeOverlay" style="background:white; z-index:9999;">
        <div style="position:fixed; top:20px; right:20px; z-index:10000;">
            <button class="btn btn-danger" onclick="exitPreviewMode()">
                <i class="fas fa-times"></i> Exit Preview
            </button>
        </div>
        <iframe id="previewModeFrame" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-item" onclick="editElement()">
            <i class="fas fa-edit"></i> Edit Properties
        </div>
        <div class="context-item" onclick="openScriptEditor()">
            <i class="fas fa-code"></i> Add Behavior (Blocks)
        </div>
        <div class="context-item" onclick="editElementCode()">
            <i class="fas fa-file-code"></i> Edit HTML
        </div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="duplicateElement()">
            <i class="fas fa-copy"></i> Duplicate
        </div>
        <div class="context-item" onclick="copyElement()">
            <i class="fas fa-clipboard"></i> Copy
        </div>
        <div class="context-item" onclick="pasteElement()">
            <i class="fas fa-paste"></i> Paste
        </div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="moveElementUp()">
            <i class="fas fa-arrow-up"></i> Move Up
        </div>
        <div class="context-item" onclick="moveElementDown()">
            <i class="fas fa-arrow-down"></i> Move Down
        </div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="deleteElement()" style="color:var(--danger)">
            <i class="fas fa-trash"></i> Delete
        </div>
    </div>

    <!-- Hover Info -->
    <div class="hover-info" id="hoverInfo"></div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="quick-btn" onclick="undo()" title="Undo">
            <i class="fas fa-undo"></i>
        </button>
        <button class="quick-btn" onclick="toggleAIChat()" title="AI Assistant">
            <i class="fas fa-robot"></i>
        </button>
        <button class="quick-btn" onclick="openCodeEditor()" title="Code Editor">
            <i class="fas fa-code"></i>
        </button>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-card">
            <div class="tutorial-icon"><i class="fas fa-magic"></i></div>
            <h2 style="margin-bottom:15px;">Welcome to WebCraft AI Pro!</h2>
            <p style="color:var(--gray); margin-bottom:20px; line-height:1.6;">
                Build apps by talking to AI in any language, drag blocks to add behavior,<br>
                or code manually. Everything works on mobile too!
            </p>
            <button class="btn btn-primary" style="width:100%;" onclick="closeTutorial()">
                Start Building
            </button>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar" id="statsBar">
        <span><i class="fas fa-cube"></i> <span id="elementCount">0</span> Elements</span>
        <span><i class="fas fa-code"></i> <span id="codeLines">0</span> Lines</span>
        <span><i class="fas fa-save"></i> Auto-saved</span>
        <span><i class="fas fa-wifi"></i> Ready</span>
    </div>

    <script>
        // ==================== STATE MANAGEMENT ====================
        const AppState = {
            elements: [],
            selectedId: null,
            history: [],
            historyIndex: -1,
            device: 'desktop',
            theme: 'dark',
            codeEditors: {},
            clipboard: null,
            currentScriptElement: null,
            draggedBlock: null,
            isPreviewMode: false,
            aiContext: [],
            stats: { elements: 0, lines: 0 }
        };

        let elementCounter = 0;
        let codeEditorInstance = null;

        // ==================== COMPONENT LIBRARY (100+ COMPONENTS) ====================
        const ComponentLibrary = [
            // Layout Components
            { type: 'div', icon: 'fa-square', name: 'Container', category: 'layout', description: 'Generic container' },
            { type: 'section', icon: 'fa-window-maximize', name: 'Section', category: 'layout', description: 'Page section' },
            { type: 'header', icon: 'fa-arrow-up', name: 'Header', category: 'layout', description: 'Page header' },
            { type: 'footer', icon: 'fa-arrow-down', name: 'Footer', category: 'layout', description: 'Page footer' },
            { type: 'nav', icon: 'fa-bars', name: 'Navigation', category: 'layout', description: 'Nav bar' },
            { type: 'aside', icon: 'fa-columns', name: 'Sidebar', category: 'layout', description: 'Side content' },
            { type: 'main', icon: 'fa-expand', name: 'Main', category: 'layout', description: 'Main content' },
            { type: 'article', icon: 'fa-newspaper', name: 'Article', category: 'layout', description: 'Article content' },
            
            // Typography
            { type: 'h1', icon: 'fa-heading', name: 'Heading 1', category: 'typography', description: 'Main title' },
            { type: 'h2', icon: 'fa-heading', name: 'Heading 2', category: 'typography', description: 'Section title' },
            { type: 'h3', icon: 'fa-heading', name: 'Heading 3', category: 'typography', description: 'Subsection' },
            { type: 'h4', icon: 'fa-heading', name: 'Heading 4', category: 'typography', description: 'Small heading' },
            { type: 'p', icon: 'fa-paragraph', name: 'Paragraph', category: 'typography', description: 'Text block' },
            { type: 'span', icon: 'fa-font', name: 'Span', category: 'typography', description: 'Inline text' },
            { type: 'strong', icon: 'fa-bold', name: 'Bold', category: 'typography', description: 'Bold text' },
            { type: 'em', icon: 'fa-italic', name: 'Italic', category: 'typography', description: 'Italic text' },
            { type: 'blockquote', icon: 'fa-quote-left', name: 'Quote', category: 'typography', description: 'Block quote' },
            { type: 'pre', icon: 'fa-code', name: 'Code Block', category: 'typography', description: 'Preformatted' },
            { type: 'code', icon: 'fa-terminal', name: 'Inline Code', category: 'typography', description: 'Code snippet' },
            
            // Form Elements
            { type: 'button', icon: 'fa-hand-pointer', name: 'Button', category: 'form', description: 'Clickable button' },
            { type: 'input', icon: 'fa-keyboard', name: 'Text Input', category: 'form', description: 'Single line input' },
            { type: 'textarea', icon: 'fa-align-justify', name: 'Textarea', category: 'form', description: 'Multi line input' },
            { type: 'select', icon: 'fa-list', name: 'Select', category: 'form', description: 'Dropdown menu' },
            { type: 'option', icon: 'fa-check', name: 'Option', category: 'form', description: 'Select option' },
            { type: 'label', icon: 'fa-tag', name: 'Label', category: 'form', description: 'Input label' },
            { type: 'form', icon: 'fa-wpforms', name: 'Form', category: 'form', description: 'Form container' },
            { type: 'checkbox', icon: 'fa-check-square', name: 'Checkbox', category: 'form', description: 'Check input' },
            { type: 'radio', icon: 'fa-dot-circle', name: 'Radio', category: 'form', description: 'Radio input' },
            { type: 'range', icon: 'fa-sliders-h', name: 'Range', category: 'form', description: 'Slider input' },
            { type: 'date', icon: 'fa-calendar', name: 'Date', category: 'form', description: 'Date picker' },
            { type: 'file', icon: 'fa-file-upload', name: 'File Input', category: 'form', description: 'File upload' },
            { type: 'submit', icon: 'fa-paper-plane', name: 'Submit', category: 'form', description: 'Submit button' },
            { type: 'reset', icon: 'fa-undo', name: 'Reset', category: 'form', description: 'Reset button' },
            
            // Media
            { type: 'img', icon: 'fa-image', name: 'Image', category: 'media', description: 'Picture' },
            { type: 'video', icon: 'fa-video', name: 'Video', category: 'media', description: 'Video player' },
            { type: 'audio', icon: 'fa-music', name: 'Audio', category: 'media', description: 'Audio player' },
            { type: 'iframe', icon: 'fa-window-restore', name: 'Iframe', category: 'media', description: 'Embed content' },
            { type: 'canvas', icon: 'fa-paint-brush', name: 'Canvas', category: 'media', description: 'Drawing area' },
            { type: 'svg', icon: 'fa-shapes', name: 'SVG', category: 'media', description: 'Vector graphic' },
            { type: 'figure', icon: 'fa-image', name: 'Figure', category: 'media', description: 'Image with caption' },
            { type: 'figcaption', icon: 'fa-font', name: 'Caption', category: 'media', description: 'Image caption' },
            
            // Interactive Components
            { type: 'a', icon: 'fa-link', name: 'Link', category: 'interactive', description: 'Hyperlink' },
            { type: 'modal', icon: 'fa-window-restore', name: 'Modal', category: 'interactive', description: 'Popup dialog' },
            { type: 'dropdown', icon: 'fa-caret-down', name: 'Dropdown', category: 'interactive', description: 'Menu dropdown' },
            { type: 'tabs', icon: 'fa-folder', name: 'Tabs', category: 'interactive', description: 'Tab container' },
            { type: 'accordion', icon: 'fa-stream', name: 'Accordion', category: 'interactive', description: 'Collapsible' },
            { type: 'carousel', icon: 'fa-images', name: 'Carousel', category: 'interactive', description: 'Image slider' },
            { type: 'tooltip', icon: 'fa-comment', name: 'Tooltip', category: 'interactive', description: 'Hint popup' },
            { type: 'popover', icon: 'fa-info-circle', name: 'Popover', category: 'interactive', description: 'Info popup' },
            { type: 'progress', icon: 'fa-spinner', name: 'Progress', category: 'interactive', description: 'Progress bar' },
            { type: 'spinner', icon: 'fa-circle-notch', name: 'Spinner', category: 'interactive', description: 'Loading spinner' },
            { type: 'badge', icon: 'fa-certificate', name: 'Badge', category: 'interactive', description: 'Status badge' },
            { type: 'alert', icon: 'fa-exclamation-triangle', name: 'Alert', category: 'interactive', description: 'Notification' },
            { type: 'toast', icon: 'fa-bell', name: 'Toast', category: 'interactive', description: 'Auto-hide alert' },
            { type: 'avatar', icon: 'fa-user-circle', name: 'Avatar', category: 'interactive', description: 'User image' },
            { type: 'chip', icon: 'fa-tag', name: 'Chip/Tag', category: 'interactive', description: 'Compact element' },
            { type: 'list', icon: 'fa-list-ul', name: 'List', category: 'interactive', description: 'Bulleted list' },
            { type: 'listitem', icon: 'fa-circle', name: 'List Item', category: 'interactive', description: 'List entry' },
            { type: 'table', icon: 'fa-table', name: 'Table', category: 'interactive', description: 'Data table' },
            { type: 'timeline', icon: 'fa-history', name: 'Timeline', category: 'interactive', description: 'Event timeline' },
            { type: 'tree', icon: 'fa-sitemap', name: 'Tree', category: 'interactive', description: 'Hierarchical tree' },
            { type: 'calendar', icon: 'fa-calendar-alt', name: 'Calendar', category: 'interactive', description: 'Date picker' },
            { type: 'chart', icon: 'fa-chart-bar', name: 'Chart', category: 'interactive', description: 'Data visualization' },
            { type: 'map', icon: 'fa-map-marker-alt', name: 'Map', category: 'interactive', description: 'Location map' },
            { type: 'slider', icon: 'fa-sliders-h', name: 'Range Slider', category: 'interactive', description: 'Value slider' },
            { type: 'rating', icon: 'fa-star', name: 'Rating', category: 'interactive', description: 'Star rating' },
            { type: 'search', icon: 'fa-search', name: 'Search', category: 'interactive', description: 'Search input' },
            { type: 'upload', icon: 'fa-cloud-upload-alt', name: 'Upload', category: 'interactive', description: 'File uploader' },
            { type: 'divider', icon: 'fa-minus', name: 'Divider', category: 'interactive', description: 'Horizontal line' },
            { type: 'skeleton', icon: 'fa-square', name: 'Skeleton', category: 'interactive', description: 'Loading placeholder' },
            { type: 'empty', icon: 'fa-inbox', name: 'Empty State', category: 'interactive', description: 'No content view' },
            { type: 'statistic', icon: 'fa-chart-line', name: 'Statistic', category: 'interactive', description: 'Number display' },
            { type: 'stepper', icon: 'fa-shoe-prints', name: 'Stepper', category: 'interactive', description: 'Step indicator' },
            { type: 'pagination', icon: 'fa-ellipsis-h', name: 'Pagination', category: 'interactive', description: 'Page numbers' },
            { type: 'breadcrumb', icon: 'fa-angle-right', name: 'Breadcrumb', category: 'interactive', description: 'Navigation path' },
            { type: 'drawer', icon: 'fa-columns', name: 'Drawer', category: 'interactive', description: 'Side panel' },
            { type: 'menu', icon: 'fa-bars', name: 'Menu', category: 'interactive', description: 'Navigation menu' },
            { type: 'menubar', icon: 'fa-ellipsis-v', name: 'Menu Bar', category: 'interactive', description: 'Top menu' },
            { type: 'toolbar', icon: 'fa-tools', name: 'Toolbar', category: 'interactive', description: 'Action bar' },
            { type: 'card', icon: 'fa-id-card', name: 'Card', category: 'interactive', description: 'Content container' },
            { type: 'grid', icon: 'fa-th', name: 'Grid', category: 'interactive', description: 'CSS Grid' },
            { type: 'flex', icon: 'fa-arrows-alt-h', name: 'Flexbox', category: 'interactive', description: 'Flex container' }
        ];

        // ==================== TEMPLATE LIBRARY (50+ TEMPLATES) ====================
        const TemplateLibrary = [
            { id: 'blank', name: 'Blank Page', icon: 'fa-file', desc: 'Start fresh', category: 'basic' },
            { id: 'landing', name: 'Landing Page', icon: 'fa-rocket', desc: 'Marketing page', category: 'business' },
            { id: 'saas', name: 'SaaS Product', icon: 'fa-cloud', desc: 'Software landing', category: 'business' },
            { id: 'startup', name: 'Startup', icon: 'fa-rocket', desc: 'Tech startup', category: 'business' },
            { id: 'corporate', name: 'Corporate', icon: 'fa-building', desc: 'Enterprise site', category: 'business' },
            { id: 'agency', name: 'Creative Agency', icon: 'fa-paint-brush', desc: 'Design studio', category: 'business' },
            { id: 'consulting', name: 'Consulting', icon: 'fa-handshake', desc: 'Business consulting', category: 'business' },
            { id: 'lawyer', name: 'Law Firm', icon: 'fa-balance-scale', desc: 'Legal services', category: 'business' },
            { id: 'medical', name: 'Medical/Health', icon: 'fa-heartbeat', desc: 'Healthcare site', category: 'business' },
            { id: 'realestate', name: 'Real Estate', icon: 'fa-home', desc: 'Property listings', category: 'business' },
            { id: 'restaurant', name: 'Restaurant', icon: 'fa-utensils', desc: 'Food & dining', category: 'business' },
            { id: 'hotel', name: 'Hotel/Resort', icon: 'fa-bed', desc: 'Hospitality', category: 'business' },
            { id: 'gym', name: 'Fitness/Gym', icon: 'fa-dumbbell', desc: 'Health club', category: 'business' },
            { id: 'salon', name: 'Beauty Salon', icon: 'fa-cut', desc: 'Beauty services', category: 'business' },
            { id: 'dashboard', name: 'Analytics Dashboard', icon: 'fa-chart-line', desc: 'Data dashboard', category: 'dashboard' },
            { id: 'admin', name: 'Admin Panel', icon: 'fa-user-shield', desc: 'Management UI', category: 'dashboard' },
            { id: 'crm', name: 'CRM System', icon: 'fa-users', desc: 'Customer management', category: 'dashboard' },
            { id: 'ecommerce', name: 'E-Commerce Shop', icon: 'fa-shopping-cart', desc: 'Online store', category: 'ecommerce' },
            { id: 'marketplace', name: 'Marketplace', icon: 'fa-store', desc: 'Multi-vendor', category: 'ecommerce' },
            { id: 'product', name: 'Product Page', icon: 'fa-box', desc: 'Single product', category: 'ecommerce' },
            { id: 'cart', name: 'Shopping Cart', icon: 'fa-shopping-bag', desc: 'Checkout flow', category: 'ecommerce' },
            { id: 'portfolio', name: 'Creative Portfolio', icon: 'fa-briefcase', desc: 'Showcase work', category: 'portfolio' },
            { id: 'photography', name: 'Photography', icon: 'fa-camera', desc: 'Photo gallery', category: 'portfolio' },
            { id: 'designer', name: 'Designer CV', icon: 'fa-palette', desc: 'Resume site', category: 'portfolio' },
            { id: 'developer', name: 'Developer Portfolio', icon: 'fa-code', desc: 'Code projects', category: 'portfolio' },
            { id: 'blog', name: 'Personal Blog', icon: 'fa-blog', desc: 'Articles & posts', category: 'content' },
            { id: 'magazine', name: 'Online Magazine', icon: 'fa-newspaper', desc: 'News site', category: 'content' },
            { id: 'wiki', name: 'Documentation', icon: 'fa-book', desc: 'Docs/Wiki', category: 'content' },
            { id: 'knowledgebase', name: 'Help Center', icon: 'fa-question-circle', desc: 'Support articles', category: 'content' },
            { id: 'social', name: 'Social Network', icon: 'fa-users', desc: 'Community site', category: 'social' },
            { id: 'forum', name: 'Discussion Forum', icon: 'fa-comments', desc: 'Q&A platform', category: 'social' },
            { id: 'chat', name: 'Chat/Messaging', icon: 'fa-comment-dots', desc: 'Real-time chat', category: 'social' },
            { id: 'auth', name: 'Login/Register', icon: 'fa-lock', desc: 'Authentication', category: 'system' },
            { id: 'profile', name: 'User Profile', icon: 'fa-user', desc: 'Account page', category: 'system' },
            { id: 'settings', name: 'Settings Panel', icon: 'fa-cog', desc: 'Configuration', category: 'system' },
            { id: 'error404', name: '404 Error', icon: 'fa-exclamation-circle', desc: 'Not found page', category: 'system' },
            { id: 'maintenance', name: 'Maintenance', icon: 'fa-wrench', desc: 'Coming soon', category: 'system' },
            { id: 'music', name: 'Music Player', icon: 'fa-music', desc: 'Audio streaming', category: 'media' },
            { id: 'video', name: 'Video Platform', icon: 'fa-play-circle', desc: 'Video streaming', category: 'media' },
            { id: 'gallery', name: 'Image Gallery', icon: 'fa-images', desc: 'Photo album', category: 'media' },
            { id: 'game', name: 'Game UI', icon: 'fa-gamepad', desc: 'Gaming interface', category: 'specialized' },
            { id: 'booking', name: 'Booking System', icon: 'fa-calendar-check', desc: 'Reservations', category: 'specialized' },
            { id: 'events', name: 'Event Management', icon: 'fa-ticket-alt', desc: 'Events & tickets', category: 'specialized' },
            { id: 'learning', name: 'LMS/Education', icon: 'fa-graduation-cap', desc: 'Online courses', category: 'specialized' },
            { id: 'banking', name: 'Finance/Banking', icon: 'fa-university', desc: 'Financial app', category: 'specialized' },
            { id: 'weather', name: 'Weather App', icon: 'fa-cloud-sun', desc: 'Forecast UI', category: 'specialized' },
            { id: 'todo', name: 'Todo/Tasks', icon: 'fa-check-circle', desc: 'Task manager', category: 'specialized' },
            { id: 'notes', name: 'Notes App', icon: 'fa-sticky-note', desc: 'Note taking', category: 'specialized' },
            { id: 'calendarapp', name: 'Calendar App', icon: 'fa-calendar-alt', desc: 'Schedule planner', category: 'specialized' },
            { id: 'mail', name: 'Email Client', icon: 'fa-envelope', desc: 'Mail inbox', category: 'specialized' },
            { id: 'filemanager', name: 'File Manager', icon: 'fa-folder-open', desc: 'File browser', category: 'specialized' },
            { id: 'codeeditor', name: 'Code Editor UI', icon: 'fa-code', desc: 'IDE interface', category: 'specialized' },
            { id: 'terminal', name: 'Terminal', icon: 'fa-terminal', desc: 'Command line UI', category: 'specialized' },
            { id: 'mapapp', name: 'Maps/Location', icon: 'fa-map', desc: 'Navigation app', category: 'specialized' }
        ];

        // ==================== ASSET LIBRARY (100+ ASSETS) ====================
        const AssetLibrary = {
            icons: [
                'fa-home', 'fa-user', 'fa-cog', 'fa-heart', 'fa-star', 'fa-bell', 'fa-search',
                'fa-envelope', 'fa-phone', 'fa-map-marker', 'fa-calendar', 'fa-clock', 'fa-image',
                'fa-music', 'fa-video', 'fa-file', 'fa-folder', 'fa-download', 'fa-upload',
                'fa-share', 'fa-edit', 'fa-trash', 'fa-plus', 'fa-minus', 'fa-check', 'fa-times',
                'fa-arrow-left', 'fa-arrow-right', 'fa-arrow-up', 'fa-arrow-down', 'fa-refresh',
                'fa-sync', 'fa-lock', 'fa-unlock', 'fa-eye', 'fa-eye-slash', 'fa-filter',
                'fa-sort', 'fa-sort-up', 'fa-sort-down', 'fa-undo', 'fa-redo', 'fa-cut',
                'fa-copy', 'fa-paste', 'fa-print', 'fa-save', 'fa-cloud', 'fa-wifi', 'fa-battery',
                'fa-signal', 'fa-globe', 'fa-map', 'fa-location-arrow', 'fa-compass', 'fa-road',
                'fa-plane', 'fa-car', 'fa-bus', 'fa-train', 'fa-ship', 'fa-bicycle', 'fa-walking',
                'fa-running', 'fa-swimmer', 'fa-futbol', 'fa-basketball-ball', 'fa-baseball-ball',
                'fa-golf-ball', 'fa-table-tennis', 'fa-dumbbell', 'fa-heartbeat', 'fa-medkit',
                'fa-hospital', 'fa-ambulance', 'fa-pills', 'fa-flask', 'fa-microscope',
                'fa-graduation-cap', 'fa-book', 'fa-library', 'fa-chalkboard', 'fa-pencil',
                'fa-pen', 'fa-paint-brush', 'fa-palette', 'fa-fill-drip', 'fa-swatchbook',
                'fa-shopping-cart', 'fa-shopping-bag', 'fa-store', 'fa-credit-card', 'fa-money',
                'fa-coins', 'fa-gift', 'fa-tag', 'fa-tags', 'fa-barcode', 'fa-qrcode',
                'fa-camera', 'fa-camera-retro', 'fa-microphone', 'fa-headphones', 'fa-volume-up',
                'fa-play', 'fa-pause', 'fa-stop', 'fa-forward', 'fa-backward', 'fa-step-forward',
                'fa-step-backward', 'fa-random', 'fa-repeat', 'fa-list', 'fa-th', 'fa-th-large',
                'fa-th-list', 'fa-bars', 'fa-ellipsis-h', 'fa-ellipsis-v', 'fa-toggle-on',
                'fa-toggle-off', 'fa-check-circle', 'fa-times-circle', 'fa-question-circle',
                'fa-info-circle', 'fa-exclamation-circle', 'fa-exclamation-triangle', 'fa-ban',
                'fa-plus-circle', 'fa-minus-circle', 'fa-times-circle', 'fa-check-square',
                'fa-circle', 'fa-dot-circle', 'fa-square', 'fa-certificate', 'fa-award',
                'fa-trophy', 'fa-medal', 'fa-crown', 'fa-gem', 'fa-fire', 'fa-bolt', 'fa-sun',
                'fa-moon', 'fa-cloud', 'fa-snowflake', 'fa-umbrella', 'fa-leaf', 'fa-tree',
                'fa-seedling', 'fa-recycle', 'fa-trash-alt', 'fa-broom', 'fa-magic', 'fa-wand',
                'fa-hat-wizard', 'fa-ghost', 'fa-skull', 'fa-pumpkin', 'fa-spider', 'fa-bug',
                'fa-code', 'fa-terminal', 'fa-laptop', 'fa-desktop', 'fa-tablet', 'fa-mobile',
                'fa-keyboard', 'fa-mouse', 'fa-plug', 'fa-battery-full', 'fa-battery-half',
                'fa-battery-quarter', 'fa-battery-empty', 'fa-robot', 'fa-rocket', 'fa-satellite',
                'fa-meteor', 'fa-user-astronaut', 'fa-user-ninja', 'fa-user-secret', 'fa-user-tie'
            ],
            colors: [
                '#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981', '#06b6d4',
                '#3b82f6', '#6366f1', '#8b5cf6', '#d946ef', '#f43f5e', '#0f172a',
                '#334155', '#64748b', '#94a3b8', '#cbd5e1', '#e2e8f0', '#f8fafc',
                '#ffffff', '#000000', '#dc2626', '#ea580c', '#ca8a04', '#65a30d',
                '#059669', '#0891b2', '#2563eb', '#4f46e5', '#7c3aed', '#c026d3',
                '#e11d48', '#991b1b', '#9a3412', '#854d0e', '#3f6212', '#065f46',
                '#155e75', '#1e40af', '#3730a3', '#5b21b6', '#86198f', '#9f1239'
            ],
            gradients: [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
                'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
                'linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
            ],
            shadows: [
                '0 1px 3px rgba(0,0,0,0.12)',
                '0 4px 6px rgba(0,0,0,0.1)',
                '0 10px 15px rgba(0,0,0,0.1)',
                '0 20px 25px rgba(0,0,0,0.15)',
                '0 25px 50px -12px rgba(0,0,0,0.25)',
                '0 0 0 1px rgba(0,0,0,0.05)',
                'inset 0 2px 4px rgba(0,0,0,0.06)',
                '0 0 20px rgba(99, 102, 241, 0.4)'
            ],
            animations: [
                { name: 'fadeIn', css: '@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }' },
                { name: 'slideUp', css: '@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }' },
                { name: 'slideDown', css: '@keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }' },
                { name: 'slideLeft', css: '@keyframes slideLeft { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }' },
                { name: 'slideRight', css: '@keyframes slideRight { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }' },
                { name: 'scale', css: '@keyframes scale { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }' },
                { name: 'rotate', css: '@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }' },
                { name: 'bounce', css: '@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }' },
                { name: 'shake', css: '@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }' },
                { name: 'pulse', css: '@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }' },
                { name: 'flip', css: '@keyframes flip { from { transform: perspective(400px) rotateY(0); } to { transform: perspective(400px) rotateY(360deg); } }' },
                { name: 'zoomIn', css: '@keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }' }
            ]
        };

        // ==================== BLOCK DEFINITIONS (100+ BLOCKS) ====================
        const BlockDefinitions = {
            events: [
                { id: 'onClick', name: 'When Clicked', icon: 'fa-hand-pointer', params: [] },
                { id: 'onDoubleClick', name: 'When Double Clicked', icon: 'fa-mouse', params: [] },
                { id: 'onRightClick', name: 'When Right Clicked', icon: 'fa-hand-rock', params: [] },
                { id: 'onMouseEnter', name: 'When Mouse Enters', icon: 'fa-arrow-right', params: [] },
                { id: 'onMouseLeave', name: 'When Mouse Leaves', icon: 'fa-arrow-left', params: [] },
                { id: 'onLoad', name: 'When Page Loads', icon: 'fa-spinner', params: [] },
                { id: 'onScroll', name: 'When Scrolled', icon: 'fa-arrows-alt-v', params: [] },
                { id: 'onResize', name: 'When Resized', icon: 'fa-expand', params: [] },
                { id: 'onKeyPress', name: 'When Key Pressed', icon: 'fa-keyboard', params: [{ name: 'key', type: 'text', default: 'Enter' }] },
                { id: 'onChange', name: 'When Value Changes', icon: 'fa-edit', params: [] },
                { id: 'onInput', name: 'When Typing', icon: 'fa-i-cursor', params: [] },
                { id: 'onFocus', name: 'When Focused', icon: 'fa-crosshairs', params: [] },
                { id: 'onBlur', name: 'When Blurred', icon: 'fa-dot-circle', params: [] },
                { id: 'onSubmit', name: 'When Form Submitted', icon: 'fa-paper-plane', params: [] },
                { id: 'onDragStart', name: 'When Drag Starts', icon: 'fa-hand-rock', params: [] },
                { id: 'onDrop', name: 'When Dropped', icon: 'fa-hand-holding', params: [] },
                { id: 'onHover', name: 'When Hovered', icon: 'fa-hand-point-up', params: [{ name: 'duration', type: 'number', default: '500' }] }
            ],
            actions: [
                { id: 'showAlert', name: 'Show Alert', icon: 'fa-bell', params: [{ name: 'message', type: 'text', default: 'Hello!' }, { name: 'type', type: 'select', options: ['info', 'success', 'warning', 'error'], default: 'info' }] },
                { id: 'showModal', name: 'Show Modal', icon: 'fa-window-restore', params: [{ name: 'title', type: 'text', default: 'Modal Title' }, { name: 'content', type: 'text', default: 'Modal content here' }] },
                { id: 'hideModal', name: 'Hide Modal', icon: 'fa-times-circle', params: [] },
                { id: 'showElement', name: 'Show Element', icon: 'fa-eye', params: [{ name: 'target', type: 'selector', default: '#element' }] },
                { id: 'hideElement', name: 'Hide Element', icon: 'fa-eye-slash', params: [{ name: 'target', type: 'selector', default: '#element' }] },
                { id: 'toggleElement', name: 'Toggle Element', icon: 'fa-toggle-on', params: [{ name: 'target', type: 'selector', default: '#element' }] },
                { id: 'addClass', name: 'Add CSS Class', icon: 'fa-plus-circle', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'className', type: 'text', default: 'active' }] },
                { id: 'removeClass', name: 'Remove CSS Class', icon: 'fa-minus-circle', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'className', type: 'text', default: 'active' }] },
                { id: 'toggleClass', name: 'Toggle CSS Class', icon: 'fa-exchange-alt', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'className', type: 'text', default: 'active' }] },
                { id: 'setText', name: 'Set Text Content', icon: 'fa-font', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'text', type: 'text', default: 'New text' }] },
                { id: 'setHTML', name: 'Set HTML Content', icon: 'fa-code', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'html', type: 'textarea', default: '<p>HTML content</p>' }] },
                { id: 'setAttribute', name: 'Set Attribute', icon: 'fa-tag', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'attr', type: 'text', default: 'src' }, { name: 'value', type: 'text', default: '' }] },
                { id: 'removeAttribute', name: 'Remove Attribute', icon: 'fa-eraser', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'attr', type: 'text', default: 'disabled' }] },
                { id: 'setStyle', name: 'Set CSS Style', icon: 'fa-paint-brush', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'property', type: 'text', default: 'color' }, { name: 'value', type: 'text', default: 'red' }] },
                { id: 'redirect', name: 'Go to URL', icon: 'fa-external-link-alt', params: [{ name: 'url', type: 'text', default: 'https://example.com' }, { name: 'newTab', type: 'boolean', default: 'true' }] },
                { id: 'scrollTo', name: 'Scroll To Element', icon: 'fa-arrow-down', params: [{ name: 'target', type: 'selector', default: '#section' }, { name: 'behavior', type: 'select', options: ['smooth', 'auto'], default: 'smooth' }] },
                { id: 'scrollToTop', name: 'Scroll To Top', icon: 'fa-arrow-up', params: [{ name: 'behavior', type: 'select', options: ['smooth', 'auto'], default: 'smooth' }] },
                { id: 'copyToClipboard', name: 'Copy to Clipboard', icon: 'fa-clipboard', params: [{ name: 'text', type: 'text', default: '' }] },
                { id: 'printPage', name: 'Print Page', icon: 'fa-print', params: [] },
                { id: 'reloadPage', name: 'Reload Page', icon: 'fa-sync', params: [] },
                { id: 'goBack', name: 'Go Back', icon: 'fa-arrow-left', params: [] },
                { id: 'goForward', name: 'Go Forward', icon: 'fa-arrow-right', params: [] }
            ],
            logic: [
                { id: 'if', name: 'If Condition', icon: 'fa-code-branch', params: [{ name: 'condition', type: 'textarea', default: 'true' }] },
                { id: 'ifElse', name: 'If Else', icon: 'fa-code-branch', params: [{ name: 'condition', type: 'textarea', default: 'true' }] },
                { id: 'switch', name: 'Switch Case', icon: 'fa-random', params: [{ name: 'expression', type: 'text', default: 'value' }] },
                { id: 'repeat', name: 'Repeat Times', icon: 'fa-redo', params: [{ name: 'times', type: 'number', default: '5' }] },
                { id: 'repeatForever', name: 'Repeat Forever', icon: 'fa-infinity', params: [] },
                { id: 'while', name: 'While Loop', icon: 'fa-sync-alt', params: [{ name: 'condition', type: 'textarea', default: 'true' }] },
                { id: 'forEach', name: 'For Each Item', icon: 'fa-list', params: [{ name: 'array', type: 'text', default: 'items' }, { name: 'itemName', type: 'text', default: 'item' }] },
                { id: 'break', name: 'Break Loop', icon: 'fa-stop', params: [] },
                { id: 'continue', name: 'Continue', icon: 'fa-step-forward', params: [] },
                { id: 'wait', name: 'Wait Seconds', icon: 'fa-clock', params: [{ name: 'seconds', type: 'number', default: '1' }] },
                { id: 'waitUntil', name: 'Wait Until', icon: 'fa-hourglass-half', params: [{ name: 'condition', type: 'textarea', default: 'true' }] },
                { id: 'tryCatch', name: 'Try Catch', icon: 'fa-shield-alt', params: [] },
                { id: 'throwError', name: 'Throw Error', icon: 'fa-exclamation-circle', params: [{ name: 'message', type: 'text', default: 'Error occurred' }] }
            ],
            data: [
                { id: 'setVariable', name: 'Set Variable', icon: 'fa-variable', params: [{ name: 'name', type: 'text', default: 'myVar' }, { name: 'value', type: 'text', default: '' }] },
                { id: 'getVariable', name: 'Get Variable', icon: 'fa-dollar-sign', params: [{ name: 'name', type: 'text', default: 'myVar' }] },
                { id: 'increment', name: 'Increment', icon: 'fa-plus', params: [{ name: 'name', type: 'text', default: 'counter' }, { name: 'amount', type: 'number', default: '1' }] },
                { id: 'decrement', name: 'Decrement', icon: 'fa-minus', params: [{ name: 'name', type: 'text', default: 'counter' }, { name: 'amount', type: 'number', default: '1' }] },
                { id: 'createArray', name: 'Create Array', icon: 'fa-list-ol', params: [{ name: 'name', type: 'text', default: 'myArray' }, { name: 'items', type: 'textarea', default: 'item1, item2, item3' }] },
                { id: 'createObject', name: 'Create Object', icon: 'fa-cube', params: [{ name: 'name', type: 'text', default: 'myObject' }] },
                { id: 'getInputValue', name: 'Get Input Value', icon: 'fa-keyboard', params: [{ name: 'selector', type: 'selector', default: '#input' }] },
                { id: 'setInputValue', name: 'Set Input Value', icon: 'fa-i-cursor', params: [{ name: 'selector', type: 'selector', default: '#input' }, { name: 'value', type: 'text', default: '' }] },
                { id: 'saveLocalStorage', name: 'Save to LocalStorage', icon: 'fa-save', params: [{ name: 'key', type: 'text', default: 'data' }, { name: 'value', type: 'text', default: '' }] },
                { id: 'loadLocalStorage', name: 'Load from LocalStorage', icon: 'fa-upload', params: [{ name: 'key', type: 'text', default: 'data' }, { name: 'variable', type: 'text', default: 'savedData' }] },
                { id: 'removeLocalStorage', name: 'Remove from LocalStorage', icon: 'fa-trash', params: [{ name: 'key', type: 'text', default: 'data' }] },
                { id: 'clearLocalStorage', name: 'Clear LocalStorage', icon: 'fa-broom', params: [] },
                { id: 'setCookie', name: 'Set Cookie', icon: 'fa-cookie', params: [{ name: 'name', type: 'text', default: 'cookie' }, { name: 'value', type: 'text', default: '' }, { name: 'days', type: 'number', default: '7' }] },
                { id: 'getCookie', name: 'Get Cookie', icon: 'fa-cookie-bite', params: [{ name: 'name', type: 'text', default: 'cookie' }, { name: 'variable', type: 'text', default: 'cookieValue' }] },
                { id: 'deleteCookie', name: 'Delete Cookie', icon: 'fa-times', params: [{ name: 'name', type: 'text', default: 'cookie' }] },
                { id: 'parseJSON', name: 'Parse JSON', icon: 'fa-code', params: [{ name: 'json', type: 'textarea', default: '{}' }, { name: 'variable', type: 'text', default: 'parsed' }] },
                { id: 'stringifyJSON', name: 'Stringify JSON', icon: 'fa-file-code', params: [{ name: 'data', type: 'text', default: 'object' }, { name: 'variable', type: 'text', default: 'json' }] }
            ],
            api: [
                { id: 'fetchGet', name: 'GET Request', icon: 'fa-download', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/data' }, { name: 'variable', type: 'text', default: 'response' }] },
                { id: 'fetchPost', name: 'POST Request', icon: 'fa-upload', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/data' }, { name: 'data', type: 'textarea', default: '{}' }, { name: 'variable', type: 'text', default: 'response' }] },
                { id: 'fetchPut', name: 'PUT Request', icon: 'fa-edit', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/data/1' }, { name: 'data', type: 'textarea', default: '{}' }, { name: 'variable', type: 'text', default: 'response' }] },
                { id: 'fetchDelete', name: 'DELETE Request', icon: 'fa-trash', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/data/1' }, { name: 'variable', type: 'text', default: 'response' }] },
                { id: 'fetchPatch', name: 'PATCH Request', icon: 'fa-band-aid', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/data/1' }, { name: 'data', type: 'textarea', default: '{}' }, { name: 'variable', type: 'text', default: 'response' }] },
                { id: 'setHeader', name: 'Set Request Header', icon: 'fa-heading', params: [{ name: 'key', type: 'text', default: 'Content-Type' }, { name: 'value', type: 'text', default: 'application/json' }] },
                { id: 'handleError', name: 'Handle API Error', icon: 'fa-exclamation-triangle', params: [] },
                { id: 'retryRequest', name: 'Retry Request', icon: 'fa-redo', params: [{ name: 'times', type: 'number', default: '3' }] },
                { id: 'cancelRequest', name: 'Cancel Request', icon: 'fa-ban', params: [] },
                { id: 'uploadFile', name: 'Upload File', icon: 'fa-cloud-upload-alt', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/upload' }, { name: 'selector', type: 'selector', default: '#fileInput' }] },
                { id: 'downloadFile', name: 'Download File', icon: 'fa-cloud-download-alt', params: [{ name: 'url', type: 'text', default: 'https://example.com/file.pdf' }, { name: 'filename', type: 'text', default: 'file.pdf' }] },
                { id: 'websocketConnect', name: 'WebSocket Connect', icon: 'fa-plug', params: [{ name: 'url', type: 'text', default: 'wss://example.com/socket' }] },
                { id: 'websocketSend', name: 'WebSocket Send', icon: 'fa-paper-plane', params: [{ name: 'data', type: 'textarea', default: '{}' }] },
                { id: 'websocketClose', name: 'WebSocket Close', icon: 'fa-times', params: [] },
                { id: 'graphqlQuery', name: 'GraphQL Query', icon: 'fa-project-diagram', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/graphql' }, { name: 'query', type: 'textarea', default: '{ users { id name } }' }] },
                { id: 'graphqlMutation', name: 'GraphQL Mutation', icon: 'fa-edit', params: [{ name: 'url', type: 'text', default: 'https://api.example.com/graphql' }, { name: 'mutation', type: 'textarea', default: 'mutation { createUser(name: "John") { id } }' }] }
            ],
            animation: [
                { id: 'fadeIn', name: 'Fade In', icon: 'fa-sun', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'fadeOut', name: 'Fade Out', icon: 'fa-cloud', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'slideUp', name: 'Slide Up', icon: 'fa-arrow-up', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'slideDown', name: 'Slide Down', icon: 'fa-arrow-down', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'slideLeft', name: 'Slide Left', icon: 'fa-arrow-left', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'slideRight', name: 'Slide Right', icon: 'fa-arrow-right', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'bounce', name: 'Bounce', icon: 'fa-basketball-ball', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'shake', name: 'Shake', icon: 'fa-bell', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '500' }] },
                { id: 'rotate', name: 'Rotate', icon: 'fa-sync', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'degrees', type: 'number', default: '360' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'scale', name: 'Scale', icon: 'fa-expand', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'scale', type: 'number', default: '1.2' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'flip', name: 'Flip', icon: 'fa-undo', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '600' }] },
                { id: 'pulse', name: 'Pulse', icon: 'fa-heartbeat', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'rubberBand', name: 'Rubber Band', icon: 'fa-band-aid', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'wobble', name: 'Wobble', icon: 'fa-wave-square', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'jello', name: 'Jello', icon: 'fa-gelatin', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1000' }] },
                { id: 'heartBeat', name: 'Heart Beat', icon: 'fa-heart', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '1300' }] },
                { id: 'hinge', name: 'Hinge', icon: 'fa-door-open', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '2000' }] },
                { id: 'zoomIn', name: 'Zoom In', icon: 'fa-search-plus', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'zoomOut', name: 'Zoom Out', icon: 'fa-search-minus', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'duration', type: 'number', default: '300' }] },
                { id: 'customAnimation', name: 'Custom CSS Animation', icon: 'fa-magic', params: [{ name: 'target', type: 'selector', default: '#element' }, { name: 'keyframes', type: 'textarea', default: '@keyframes custom { from { opacity: 0; } to { opacity: 1; } }' }, { name: 'duration', type: 'number', default: '1000' }] }
            ]
        };

        // ==================== AI SYSTEM (MULTI-LANGUAGE) ====================
        const AISystem = {
            languages: ['en', 'ar', 'es', 'fr', 'de', 'zh', 'ja', 'ru', 'pt', 'hi'],
            
            patterns: {
                en: {
                    create: /create|make|build|generate/i,
                    todo: /todo|task|list/i,
                    login: /login|signin|auth/i,
                    register: /register|signup|account/i,
                    dashboard: /dashboard|admin|panel/i,
                    shop: /shop|store|ecommerce|product/i,
                    blog: /blog|article|post/i,
                    portfolio: /portfolio|gallery|showcase/i,
                    landing: /landing|homepage|marketing/i,
                    contact: /contact|form|message/i,
                    navbar: /nav|menu|header/i,
                    footer: /footer|bottom/i,
                    card: /card|item|box/i,
                    button: /button|click/i,
                    input: /input|field|text/i,
                    image: /image|photo|picture/i,
                    table: /table|grid|data/i,
                    chart: /chart|graph|stat/i,
                    map: /map|location/i,
                    video: /video|movie/i,
                    audio: /audio|music|sound/i
                },
                ar: {
                    create: /انشئ|اصنع|ابني|create/i,
                    todo: /مهام|قائمة|todo/i,
                    login: /تسجيل دخول|login/i,
                    register: /تسجيل|حساب|signup/i,
                    dashboard: /لوحة|dashboard/i,
                    shop: /متجر|تسوق|shop/i,
                    blog: /مدونة|مقال|blog/i,
                    portfolio: /معرض|أعمال|portfolio/i,
                    landing: /صفحة|هبوط|landing/i,
                    contact: /اتصل|تواصل|contact/i,
                    navbar: /قائمة|تنقل|nav/i,
                    footer: /ذيل|footer/i,
                    card: /بطاقة|card/i,
                    button: /زر|button/i,
                    input: /حقل|ادخال|input/i,
                    image: /صورة|image/i,
                    table: /جدول|table/i,
                    chart: /رسم|chart/i,
                    map: /خريطة|map/i,
                    video: /فيديو|video/i,
                    audio: /صوت|audio/i
                }
                // Add more languages as needed
            },

            generateResponse: function(input, lang = 'en') {
                const patterns = this.patterns[lang] || this.patterns.en;
                let elements = [];
                let description = '';

                // Detect intent
                if (patterns.create.test(input) || patterns.todo.test(input)) {
                    description = 'Todo List Application';
                    elements = this.generateTodoApp();
                } else if (patterns.login.test(input)) {
                    description = 'Login Form';
                    elements = this.generateLoginForm();
                } else if (patterns.register.test(input)) {
                    description = 'Registration Form';
                    elements = this.generateRegisterForm();
                } else if (patterns.dashboard.test(input)) {
                    description = 'Admin Dashboard';
                    elements = this.generateDashboard();
                } else if (patterns.shop.test(input)) {
                    description = 'E-Commerce Store';
                    elements = this.generateShop();
                } else if (patterns.blog.test(input)) {
                    description = 'Blog Layout';
                    elements = this.generateBlog();
                } else if (patterns.portfolio.test(input)) {
                    description = 'Portfolio Website';
                    elements = this.generatePortfolio();
                } else if (patterns.landing.test(input)) {
                    description = 'Landing Page';
                    elements = this.generateLanding();
                } else if (patterns.contact.test(input)) {
                    description = 'Contact Form';
                    elements = this.generateContactForm();
                } else {
                    // Default: try to understand generic request
                    description = 'Custom Application';
                    elements = this.generateGeneric(input);
                }

                return { description, elements, suggestions: this.generateSuggestions(input) };
            },

            generateTodoApp: function() {
                return [
                    { type: 'div', tag: 'div', content: '', styles: { maxWidth: '600px', margin: '0 auto', padding: '20px', fontFamily: 'Arial, sans-serif' }, attributes: {}, children: [
                        { type: 'h1', tag: 'h1', content: 'My Tasks', styles: { color: '#333', textAlign: 'center', marginBottom: '30px' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '10px', marginBottom: '20px' }, attributes: {}, children: [
                            { type: 'input', tag: 'input', content: '', styles: { flex: '1', padding: '12px', border: '2px solid #ddd', borderRadius: '8px', fontSize: '16px' }, attributes: { type: 'text', placeholder: 'Add a new task...', id: 'todoInput' }, children: [] },
                            { type: 'button', tag: 'button', content: 'Add', styles: { padding: '12px 24px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '16px' }, attributes: { id: 'addBtn', onclick: 'addTodo()' }, children: [] }
                        ]},
                        { type: 'list', tag: 'ul', content: '', styles: { listStyle: 'none', padding: '0' }, attributes: { id: 'todoList' }, children: [
                            { type: 'listitem', tag: 'li', content: 'Sample task - click to complete', styles: { padding: '15px', backgroundColor: '#f3f4f6', marginBottom: '10px', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', cursor: 'pointer' }, attributes: { onclick: 'toggleTodo(this)' }, children: [
                                { type: 'span', tag: 'span', content: '✓', styles: { color: '#10b981', fontWeight: 'bold', display: 'none' }, attributes: { class: 'check' }, children: [] },
                                { type: 'button', tag: 'button', content: 'Delete', styles: { padding: '6px 12px', backgroundColor: '#ef4444', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer' }, attributes: { onclick: 'deleteTodo(this)' }, children: [] }
                            ]}
                        ]}
                    ]}
                ];
            },

            generateLoginForm: function() {
                return [
                    { type: 'div', tag: 'div', content: '', styles: { minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '40px', borderRadius: '16px', boxShadow: '0 20px 40px rgba(0,0,0,0.2)', width: '100%', maxWidth: '400px' }, attributes: {}, children: [
                            { type: 'h2', tag: 'h2', content: 'Welcome Back', styles: { textAlign: 'center', marginBottom: '10px', color: '#1f2937' }, attributes: {}, children: [] },
                            { type: 'p', tag: 'p', content: 'Please sign in to continue', styles: { textAlign: 'center', color: '#6b7280', marginBottom: '30px' }, attributes: {}, children: [] },
                            { type: 'form', tag: 'form', content: '', styles: { display: 'flex', flexDirection: 'column', gap: '20px' }, attributes: { onsubmit: 'handleLogin(event)' }, children: [
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Email', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'email' }, children: [] },
                                    { type: 'input', tag: 'input', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px', transition: 'border-color 0.2s' }, attributes: { type: 'email', id: 'email', placeholder: 'you@example.com', required: 'true' }, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Password', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'password' }, children: [] },
                                    { type: 'input', tag: 'input', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px' }, attributes: { type: 'password', id: 'password', placeholder: '••••••••', required: 'true' }, children: [] }
                                ]},
                                { type: 'button', tag: 'button', content: 'Sign In', styles: { width: '100%', padding: '14px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '8px', fontSize: '16px', fontWeight: '600', cursor: 'pointer', marginTop: '10px' }, attributes: { type: 'submit' }, children: [] }
                            ]},
                            { type: 'p', tag: 'p', content: "Don't have an account? Sign up", styles: { textAlign: 'center', marginTop: '20px', color: '#6b7280', fontSize: '14px' }, attributes: {}, children: [
                                { type: 'a', tag: 'a', content: 'Sign up', styles: { color: '#6366f1', textDecoration: 'none', fontWeight: '600' }, attributes: { href: '#' }, children: [] }
                            ]}
                        ]}
                    ]}
                ];
            },

            generateDashboard: function() {
                return [
                    { type: 'div', tag: 'div', content: '', styles: { display: 'flex', minHeight: '100vh', fontFamily: 'Arial, sans-serif' }, attributes: {}, children: [
                        { type: 'aside', tag: 'aside', content: '', styles: { width: '260px', backgroundColor: '#1e293b', color: 'white', padding: '20px 0' }, attributes: {}, children: [
                            { type: 'div', tag: 'div', content: 'Dashboard', styles: { padding: '0 20px 20px', fontSize: '24px', fontWeight: 'bold', borderBottom: '1px solid #334155' }, attributes: {}, children: [] },
                            { type: 'nav', tag: 'nav', content: '', styles: { marginTop: '20px' }, attributes: {}, children: [
                                { type: 'a', tag: 'a', content: '📊 Overview', styles: { display: 'block', padding: '12px 20px', color: 'white', textDecoration: 'none', backgroundColor: '#3b82f6' }, attributes: { href: '#' }, children: [] },
                                { type: 'a', tag: 'a', content: '👥 Users', styles: { display: 'block', padding: '12px 20px', color: '#94a3b8', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                                { type: 'a', tag: 'a', content: '📦 Products', styles: { display: 'block', padding: '12px 20px', color: '#94a3b8', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                                { type: 'a', tag: 'a', content: '📈 Analytics', styles: { display: 'block', padding: '12px 20px', color: '#94a3b8', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                                { type: 'a', tag: 'a', content: '⚙️ Settings', styles: { display: 'block', padding: '12px 20px', color: '#94a3b8', textDecoration: 'none' }, attributes: { href: '#' }, children: [] }
                            ]}
                        ]},
                        { type: 'main', tag: 'main', content: '', styles: { flex: '1', padding: '30px', backgroundColor: '#f1f5f9' }, attributes: {}, children: [
                            { type: 'h1', tag: 'h1', content: 'Dashboard Overview', styles: { fontSize: '28px', marginBottom: '30px', color: '#1e293b' }, attributes: {}, children: [] },
                            { type: 'div', tag: 'div', content: '', styles: { display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '20px', marginBottom: '30px' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '20px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'p', tag: 'p', content: 'Total Users', styles: { color: '#64748b', fontSize: '14px', marginBottom: '8px' }, attributes: {}, children: [] },
                                    { type: 'h3', tag: 'h3', content: '12,345', styles: { fontSize: '28px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'span', tag: 'span', content: '+12% from last month', styles: { color: '#10b981', fontSize: '12px' }, attributes: {}, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '20px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'p', tag: 'p', content: 'Revenue', styles: { color: '#64748b', fontSize: '14px', marginBottom: '8px' }, attributes: {}, children: [] },
                                    { type: 'h3', tag: 'h3', content: '$45,678', styles: { fontSize: '28px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'span', tag: 'span', content: '+8% from last month', styles: { color: '#10b981', fontSize: '12px' }, attributes: {}, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '20px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'p', tag: 'p', content: 'Orders', styles: { color: '#64748b', fontSize: '14px', marginBottom: '8px' }, attributes: {}, children: [] },
                                    { type: 'h3', tag: 'h3', content: '1,234', styles: { fontSize: '28px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'span', tag: 'span', content: '+23% from last month', styles: { color: '#10b981', fontSize: '12px' }, attributes: {}, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '20px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'p', tag: 'p', content: 'Bounce Rate', styles: { color: '#64748b', fontSize: '14px', marginBottom: '8px' }, attributes: {}, children: [] },
                                    { type: 'h3', tag: 'h3', content: '42.3%', styles: { fontSize: '28px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'span', tag: 'span', content: '-5% from last month', styles: { color: '#ef4444', fontSize: '12px' }, attributes: {}, children: [] }
                                ]}
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { display: 'grid', gridTemplateColumns: '2fr 1fr', gap: '20px' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '30px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', minHeight: '400px' }, attributes: {}, children: [
                                    { type: 'h4', tag: 'h4', content: 'Traffic Overview', styles: { marginBottom: '20px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'div', tag: 'div', content: '[Chart Placeholder]', styles: { height: '300px', backgroundColor: '#f8fafc', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#94a3b8' }, attributes: {}, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '30px', borderRadius: '12px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'h4', tag: 'h4', content: 'Recent Activity', styles: { marginBottom: '20px', color: '#1e293b' }, attributes: {}, children: [] },
                                    { type: 'div', tag: 'div', content: '', styles: { display: 'flex', flexDirection: 'column', gap: '15px' }, attributes: {}, children: [
                                        { type: 'div', tag: 'div', content: '• New user registered: john@example.com', styles: { fontSize: '14px', color: '#475569' }, attributes: {}, children: [] },
                                        { type: 'div', tag: 'div', content: '• Order #1234 completed', styles: { fontSize: '14px', color: '#475569' }, attributes: {}, children: [] },
                                        { type: 'div', tag: 'div', content: '• Payment received: $299.99', styles: { fontSize: '14px', color: '#475569' }, attributes: {}, children: [] },
                                        { type: 'div', tag: 'div', content: '• New comment on blog post', styles: { fontSize: '14px', color: '#475569' }, attributes: {}, children: [] }
                                    ]}
                                ]}
                            ]}
                        ]}
                    ]}
                ];
            },

            generateShop: function() {
                return [
                    { type: 'nav', tag: 'nav', content: '', styles: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '20px 40px', backgroundColor: 'white', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: '🛍️ ShopHub', styles: { fontSize: '24px', fontWeight: 'bold', color: '#6366f1' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '30px', alignItems: 'center' }, attributes: {}, children: [
                            { type: 'a', tag: 'a', content: 'Home', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'Products', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'Cart (0)', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] }
                        ]}
                    ]},
                    { type: 'div', tag: 'div', content: '', styles: { maxWidth: '1200px', margin: '0 auto', padding: '40px 20px' }, attributes: {}, children: [
                        { type: 'h1', tag: 'h1', content: 'Featured Products', styles: { fontSize: '32px', marginBottom: '40px', textAlign: 'center', color: '#1f2937' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '30px' }, attributes: {}, children: [
                            { type: 'div', tag: 'div', content: '', styles: { border: '1px solid #e5e7eb', borderRadius: '12px', overflow: 'hidden', transition: 'transform 0.2s, box-shadow 0.2s' }, attributes: {}, children: [
                                { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/300x200/6366f1/ffffff?text=Product+1', alt: 'Product 1' }, children: [] },
                                { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                    { type: 'h3', tag: 'h3', content: 'Premium Headphones', styles: { fontSize: '18px', marginBottom: '8px', color: '#1f2937' }, attributes: {}, children: [] },
                                    { type: 'p', tag: 'p', content: '$99.99', styles: { color: '#6366f1', fontSize: '20px', fontWeight: 'bold', marginBottom: '15px' }, attributes: {}, children: [] },
                                    { type: 'button', tag: 'button', content: 'Add to Cart', styles: { width: '100%', padding: '10px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer' }, attributes: {}, children: [] }
                                ]}
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { border: '1px solid #e5e7eb', borderRadius: '12px', overflow: 'hidden' }, attributes: {}, children: [
                                { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/300x200/ec4899/ffffff?text=Product+2', alt: 'Product 2' }, children: [] },
                                { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                    { type: 'h3', tag: 'h3', content: 'Smart Watch', styles: { fontSize: '18px', marginBottom: '8px', color: '#1f2937' }, attributes: {}, children: [] },
                                    { type: 'p', tag: 'p', content: '$149.99', styles: { color: '#6366f1', fontSize: '20px', fontWeight: 'bold', marginBottom: '15px' }, attributes: {}, children: [] },
                                    { type: 'button', tag: 'button', content: 'Add to Cart', styles: { width: '100%', padding: '10px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer' }, attributes: {}, children: [] }
                                ]}
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { border: '1px solid #e5e7eb', borderRadius: '12px', overflow: 'hidden' }, attributes: {}, children: [
                                { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/300x200/10b981/ffffff?text=Product+3', alt: 'Product 3' }, children: [] },
                                { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                    { type: 'h3', tag: 'h3', content: 'Wireless Mouse', styles: { fontSize: '18px', marginBottom: '8px', color: '#1f2937' }, attributes: {}, children: [] },
                                    { type: 'p', tag: 'p', content: '$49.99', styles: { color: '#6366f1', fontSize: '20px', fontWeight: 'bold', marginBottom: '15px' }, attributes: {}, children: [] },
                                    { type: 'button', tag: 'button', content: 'Add to Cart', styles: { width: '100%', padding: '10px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer' }, attributes: {}, children: [] }
                                ]}
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { border: '1px solid #e5e7eb', borderRadius: '12px', overflow: 'hidden' }, attributes: {}, children: [
                                { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/300x200/f59e0b/ffffff?text=Product+4', alt: 'Product 4' }, children: [] },
                                { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                    { type: 'h3', tag: 'h3', content: 'USB-C Hub', styles: { fontSize: '18px', marginBottom: '8px', color: '#1f2937' }, attributes: {}, children: [] },
                                    { type: 'p', tag: 'p', content: '$79.99', styles: { color: '#6366f1', fontSize: '20px', fontWeight: 'bold', marginBottom: '15px' }, attributes: {}, children: [] },
                                    { type: 'button', tag: 'button', content: 'Add to Cart', styles: { width: '100%', padding: '10px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer' }, attributes: {}, children: [] }
                                ]}
                            ]}
                        ]}
                    ]}
                ];
            },

            generateBlog: function() {
                return [
                    { type: 'nav', tag: 'nav', content: '', styles: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '20px 40px', borderBottom: '1px solid #e5e7eb' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: 'My Blog', styles: { fontSize: '24px', fontWeight: 'bold' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '20px' }, attributes: {}, children: [
                            { type: 'a', tag: 'a', content: 'Home', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'Articles', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'About', styles: { color: '#374151', textDecoration: 'none' }, attributes: { href: '#' }, children: [] }
                        ]}
                    ]},
                    { type: 'div', tag: 'div', content: '', styles: { maxWidth: '800px', margin: '0 auto', padding: '40px 20px' }, attributes: {}, children: [
                        { type: 'h1', tag: 'h1', content: 'Latest Articles', styles: { fontSize: '36px', marginBottom: '40px' }, attributes: {}, children: [] },
                        { type: 'article', tag: 'article', content: '', styles: { marginBottom: '40px', paddingBottom: '40px', borderBottom: '1px solid #e5e7eb' }, attributes: {}, children: [
                            { type: 'h2', tag: 'h2', content: 'Getting Started with Web Development', styles: { fontSize: '28px', marginBottom: '15px', color: '#1f2937', cursor: 'pointer' }, attributes: {}, children: [] },
                            { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '15px', marginBottom: '15px', color: '#6b7280', fontSize: '14px' }, attributes: {}, children: [
                                { type: 'span', tag: 'span', content: 'Jan 15, 2024', styles: {}, attributes: {}, children: [] },
                                { type: 'span', tag: 'span', content: '•', styles: {}, attributes: {}, children: [] },
                                { type: 'span', tag: 'span', content: '5 min read', styles: {}, attributes: {}, children: [] }
                            ]},
                            { type: 'p', tag: 'p', content: 'Learn the fundamentals of modern web development including HTML, CSS, and JavaScript. This comprehensive guide will take you from beginner to advanced...', styles: { lineHeight: '1.8', color: '#4b5563', marginBottom: '15px' }, attributes: {}, children: [] },
                            { type: 'a', tag: 'a', content: 'Read more →', styles: { color: '#6366f1', textDecoration: 'none', fontWeight: '500' }, attributes: { href: '#' }, children: [] }
                        ]},
                        { type: 'article', tag: 'article', content: '', styles: { marginBottom: '40px', paddingBottom: '40px', borderBottom: '1px solid #e5e7eb' }, attributes: {}, children: [
                            { type: 'h2', tag: 'h2', content: 'Mastering CSS Grid Layout', styles: { fontSize: '28px', marginBottom: '15px', color: '#1f2937', cursor: 'pointer' }, attributes: {}, children: [] },
                            { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '15px', marginBottom: '15px', color: '#6b7280', fontSize: '14px' }, attributes: {}, children: [
                                { type: 'span', tag: 'span', content: 'Jan 10, 2024', styles: {}, attributes: {}, children: [] },
                                { type: 'span', tag: 'span', content: '•', styles: {}, attributes: {}, children: [] },
                                { type: 'span', tag: 'span', content: '8 min read', styles: {}, attributes: {}, children: [] }
                            ]},
                            { type: 'p', tag: 'p', content: 'CSS Grid is a powerful layout system available in CSS. It allows you to create complex responsive layouts with ease. In this tutorial, we will explore...', styles: { lineHeight: '1.8', color: '#4b5563', marginBottom: '15px' }, attributes: {}, children: [] },
                            { type: 'a', tag: 'a', content: 'Read more →', styles: { color: '#6366f1', textDecoration: 'none', fontWeight: '500' }, attributes: { href: '#' }, children: [] }
                        ]}
                    ]}
                ];
            },

            generatePortfolio: function() {
                return [
                    { type: 'div', tag: 'div', content: '', styles: { minHeight: '100vh', display: 'flex', flexDirection: 'column' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: '', styles: { flex: '1', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', textAlign: 'center', padding: '40px', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white' }, attributes: {}, children: [
                            { type: 'img', tag: 'img', content: '', styles: { width: '150px', height: '150px', borderRadius: '50%', marginBottom: '30px', border: '4px solid white' }, attributes: { src: 'https://via.placeholder.com/150', alt: 'Profile' }, children: [] },
                            { type: 'h1', tag: 'h1', content: 'John Doe', styles: { fontSize: '48px', marginBottom: '10px' }, attributes: {}, children: [] },
                            { type: 'p', tag: 'p', content: 'Full Stack Developer & UI/UX Designer', styles: { fontSize: '20px', opacity: '0.9', marginBottom: '30px' }, attributes: {}, children: [] },
                            { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '20px' }, attributes: {}, children: [
                                { type: 'button', tag: 'button', content: 'View Work', styles: { padding: '12px 30px', backgroundColor: 'white', color: '#667eea', border: 'none', borderRadius: '6px', fontSize: '16px', fontWeight: '600', cursor: 'pointer' }, attributes: {}, children: [] },
                                { type: 'button', tag: 'button', content: 'Contact Me', styles: { padding: '12px 30px', backgroundColor: 'transparent', color: 'white', border: '2px solid white', borderRadius: '6px', fontSize: '16px', fontWeight: '600', cursor: 'pointer' }, attributes: {}, children: [] }
                            ]}
                        ]},
                        { type: 'div', tag: 'div', content: '', styles: { padding: '80px 40px', backgroundColor: '#f8fafc' }, attributes: {}, children: [
                            { type: 'h2', tag: 'h2', content: 'My Projects', styles: { fontSize: '36px', textAlign: 'center', marginBottom: '50px', color: '#1f2937' }, attributes: {}, children: [] },
                            { type: 'div', tag: 'div', content: '', styles: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '30px', maxWidth: '1200px', margin: '0 auto' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', borderRadius: '12px', overflow: 'hidden', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/400x250/6366f1/ffffff?text=Project+1', alt: 'Project 1' }, children: [] },
                                    { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                        { type: 'h3', tag: 'h3', content: 'E-Commerce Platform', styles: { fontSize: '20px', marginBottom: '10px', color: '#1f2937' }, attributes: {}, children: [] },
                                        { type: 'p', tag: 'p', content: 'React, Node.js, MongoDB', styles: { color: '#6b7280' }, attributes: {}, children: [] }
                                    ]}
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', borderRadius: '12px', overflow: 'hidden', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/400x250/ec4899/ffffff?text=Project+2', alt: 'Project 2' }, children: [] },
                                    { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                        { type: 'h3', tag: 'h3', content: 'Mobile Banking App', styles: { fontSize: '20px', marginBottom: '10px', color: '#1f2937' }, attributes: {}, children: [] },
                                        { type: 'p', tag: 'p', content: 'React Native, Firebase', styles: { color: '#6b7280' }, attributes: {}, children: [] }
                                    ]}
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', borderRadius: '12px', overflow: 'hidden', boxShadow: '0 4px 6px rgba(0,0,0,0.1)' }, attributes: {}, children: [
                                    { type: 'img', tag: 'img', content: '', styles: { width: '100%', height: '200px', objectFit: 'cover' }, attributes: { src: 'https://via.placeholder.com/400x250/10b981/ffffff?text=Project+3', alt: 'Project 3' }, children: [] },
                                    { type: 'div', tag: 'div', content: '', styles: { padding: '20px' }, attributes: {}, children: [
                                        { type: 'h3', tag: 'h3', content: 'AI Dashboard', styles: { fontSize: '20px', marginBottom: '10px', color: '#1f2937' }, attributes: {}, children: [] },
                                        { type: 'p', tag: 'p', content: 'Vue.js, Python, TensorFlow', styles: { color: '#6b7280' }, attributes: {}, children: [] }
                                    ]}
                                ]}
                            ]}
                        ]}
                    ]}
                ];
            },

            generateLanding: function() {
                return [
                    { type: 'nav', tag: 'nav', content: '', styles: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '20px 40px', position: 'absolute', top: '0', left: '0', right: '0', zIndex: '10' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: 'Brand', styles: { fontSize: '24px', fontWeight: 'bold', color: 'white' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '30px' }, attributes: {}, children: [
                            { type: 'a', tag: 'a', content: 'Features', styles: { color: 'white', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'Pricing', styles: { color: 'white', textDecoration: 'none' }, attributes: { href: '#' }, children: [] },
                            { type: 'a', tag: 'a', content: 'Contact', styles: { color: 'white', textDecoration: 'none' }, attributes: { href: '#' }, children: [] }
                        ]}
                    ]},
                    { type: 'div', tag: 'div', content: '', styles: { minHeight: '100vh', display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', textAlign: 'center', padding: '40px', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white' }, attributes: {}, children: [
                        { type: 'h1', tag: 'h1', content: 'Build Something Amazing', styles: { fontSize: '56px', marginBottom: '20px', fontWeight: '800' }, attributes: {}, children: [] },
                        { type: 'p', tag: 'p', content: 'Create stunning web applications with our powerful platform. No coding required.', styles: { fontSize: '20px', maxWidth: '600px', marginBottom: '40px', opacity: '0.9' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'flex', gap: '20px' }, attributes: {}, children: [
                            { type: 'button', tag: 'button', content: 'Get Started Free', styles: { padding: '16px 40px', backgroundColor: 'white', color: '#667eea', border: 'none', borderRadius: '8px', fontSize: '18px', fontWeight: '600', cursor: 'pointer' }, attributes: {}, children: [] },
                            { type: 'button', tag: 'button', content: 'Watch Demo', styles: { padding: '16px 40px', backgroundColor: 'transparent', color: 'white', border: '2px solid white', borderRadius: '8px', fontSize: '18px', fontWeight: '600', cursor: 'pointer' }, attributes: {}, children: [] }
                        ]}
                    ]},
                    { type: 'div', tag: 'div', content: '', styles: { padding: '80px 40px', backgroundColor: 'white' }, attributes: {}, children: [
                        { type: 'h2', tag: 'h2', content: 'Why Choose Us', styles: { fontSize: '36px', textAlign: 'center', marginBottom: '60px', color: '#1f2937' }, attributes: {}, children: [] },
                        { type: 'div', tag: 'div', content: '', styles: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '40px', maxWidth: '1200px', margin: '0 auto' }, attributes: {}, children: [
                            { type: 'div', tag: 'div', content: '', styles: { textAlign: 'center', padding: '30px' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '⚡', styles: { fontSize: '48px', marginBottom: '20px' }, attributes: {}, children: [] },
                                { type: 'h3', tag: 'h3', content: 'Lightning Fast', styles: { fontSize: '24px', marginBottom: '15px', color: '#1f2937' }, attributes: {}, children: [] },
                                { type: 'p', tag: 'p', content: 'Optimized for speed and performance. Your apps load instantly.', styles: { color: '#6b7280', lineHeight: '1.6' }, attributes: {}, children: [] }
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { textAlign: 'center', padding: '30px' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '🛡️', styles: { fontSize: '48px', marginBottom: '20px' }, attributes: {}, children: [] },
                                { type: 'h3', tag: 'h3', content: 'Secure by Default', styles: { fontSize: '24px', marginBottom: '15px', color: '#1f2937' }, attributes: {}, children: [] },
                                { type: 'p', tag: 'p', content: 'Enterprise-grade security built into every application.', styles: { color: '#6b7280', lineHeight: '1.6' }, attributes: {}, children: [] }
                            ]},
                            { type: 'div', tag: 'div', content: '', styles: { textAlign: 'center', padding: '30px' }, attributes: {}, children: [
                                { type: 'div', tag: 'div', content: '🚀', styles: { fontSize: '48px', marginBottom: '20px' }, attributes: {}, children: [] },
                                { type: 'h3', tag: 'h3', content: 'Easy to Scale', styles: { fontSize: '24px', marginBottom: '15px', color: '#1f2937' }, attributes: {}, children: [] },
                                { type: 'p', tag: 'p', content: 'From prototype to production, scale without limits.', styles: { color: '#6b7280', lineHeight: '1.6' }, attributes: {}, children: [] }
                            ]}
                        ]}
                    ]}
                ];
            },

            generateContactForm: function() {
                return [
                    { type: 'div', tag: 'div', content: '', styles: { minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', padding: '40px 20px' }, attributes: {}, children: [
                        { type: 'div', tag: 'div', content: '', styles: { backgroundColor: 'white', padding: '40px', borderRadius: '16px', boxShadow: '0 20px 40px rgba(0,0,0,0.2)', width: '100%', maxWidth: '500px' }, attributes: {}, children: [
                            { type: 'h2', tag: 'h2', content: 'Get In Touch', styles: { textAlign: 'center', marginBottom: '10px', color: '#1f2937' }, attributes: {}, children: [] },
                            { type: 'p', tag: 'p', content: "We'd love to hear from you. Send us a message!", styles: { textAlign: 'center', color: '#6b7280', marginBottom: '30px' }, attributes: {}, children: [] },
                            { type: 'form', tag: 'form', content: '', styles: { display: 'flex', flexDirection: 'column', gap: '20px' }, attributes: { onsubmit: 'handleContact(event)' }, children: [
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Your Name', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'name' }, children: [] },
                                    { type: 'input', tag: 'input', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px' }, attributes: { type: 'text', id: 'name', placeholder: 'John Doe', required: 'true' }, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Email Address', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'email' }, children: [] },
                                    { type: 'input', tag: 'input', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px' }, attributes: { type: 'email', id: 'email', placeholder: 'john@example.com', required: 'true' }, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Subject', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'subject' }, children: [] },
                                    { type: 'input', tag: 'input', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px' }, attributes: { type: 'text', id: 'subject', placeholder: 'How can we help?', required: 'true' }, children: [] }
                                ]},
                                { type: 'div', tag: 'div', content: '', styles: {}, attributes: {}, children: [
                                    { type: 'label', tag: 'label', content: 'Message', styles: { display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '500' }, attributes: { for: 'message' }, children: [] },
                                    { type: 'textarea', tag: 'textarea', content: '', styles: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px', minHeight: '120px', resize: 'vertical' }, attributes: { id: 'message', placeholder: 'Tell us more about your project...', required: 'true' }, children: [] }
                                ]},
                                { type: 'button', tag: 'button', content: 'Send Message', styles: { width: '100%', padding: '14px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '8px', fontSize: '16px', fontWeight: '600', cursor: 'pointer' }, attributes: { type: 'submit' }, children: [] }
                            ]}
                        ]}
                    ]}
                ];
            },

            generateGeneric: function(input) {
                // Analyze input for keywords and generate appropriate structure
                const hasButton = input.match(/button|زر|click/i);
                const hasInput = input.match(/input|field|حقل|text/i);
                const hasImage = input.match(/image|صورة|photo/i);
                const hasList = input.match(/list|قائمة|menu/i);
                const hasCard = input.match(/card|بطاقة|box/i);
                
                let elements = [];
                
                if (hasButton) {
                    elements.push({
                        type: 'button',
                        tag: 'button',
                        content: 'Click Me',
                        styles: { padding: '12px 24px', backgroundColor: '#6366f1', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' },
                        attributes: {},
                        children: []
                    });
                }
                
                if (hasInput) {
                    elements.push({
                        type: 'input',
                        tag: 'input',
                        content: '',
                        styles: { padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', width: '100%', maxWidth: '300px' },
                        attributes: { type: 'text', placeholder: 'Enter text...' },
                        children: []
                    });
                }
                
                if (hasImage) {
                    elements.push({
                        type: 'img',
                        tag: 'img',
                        content: '',
                        styles: { maxWidth: '100%', height: 'auto', borderRadius: '8px' },
                        attributes: { src: 'https://via.placeholder.com/600x400', alt: 'Image' },
                        children: []
                    });
                }
                
                if (hasList) {
                    elements.push({
                        type: 'list',
                        tag: 'ul',
                        content: '',
                        styles: { listStyle: 'none', padding: '0' },
                        attributes: {},
                        children: [
                            { type: 'listitem', tag: 'li', content: 'Item 1', styles: { padding: '10px', backgroundColor: '#f3f4f6', marginBottom: '8px', borderRadius: '6px' }, attributes: {}, children: [] },
                            { type: 'listitem', tag: 'li', content: 'Item 2', styles: { padding: '10px', backgroundColor: '#f3f4f6', marginBottom: '8px', borderRadius: '6px' }, attributes: {}, children: [] },
                            { type: 'listitem', tag: 'li', content: 'Item 3', styles: { padding: '10px', backgroundColor: '#f3f4f6', borderRadius: '6px' }, attributes: {}, children: [] }
                        ]
                    });
                }
                
                if (hasCard) {
                    elements.push({
                        type: 'card',
                        tag: 'div',
                        content: '',
                        styles: { backgroundColor: 'white', padding: '24px', borderRadius: '12px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', maxWidth: '400px' },
                        attributes: {},
                        children: [
                            { type: 'h3', tag: 'h3', content: 'Card Title', styles: { marginBottom: '12px', color: '#1f2937' }, attributes: {}, children: [] },
                            { type: 'p', tag: 'p', content: 'This is a card component with some content inside it.', styles: { color: '#6b7280', lineHeight: '1.6' }, attributes: {}, children: [] }
                        ]
                    });
                }
                
                if (elements.length === 0) {
                    elements.push({
                        type: 'div',
                        tag: 'div',
                        content: 'Generated content based on: ' + input,
                        styles: { padding: '20px', backgroundColor: '#f3f4f6', borderRadius: '8px', color: '#374151' },
                        attributes: {},
                        children: []
                    });
                }
                
                return elements;
            },

            generateSuggestions: function(input) {
                return [
                    'Add more ' + (input.includes('button') ? 'inputs' : 'buttons'),
                    'Change colors to match brand',
                    'Add animations on hover',
                    'Make it responsive for mobile',
                    'Add form validation',
                    'Connect to backend API'
                ];
            }
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            renderComponents();
            renderTemplates();
            renderAssets();
            initCodeEditor();
            initDragAndDrop();
            initTouchEvents();
            initKeyboardShortcuts();
            initContextMenu();
            loadFromStorage();
            updateStats();
            
            // Show tutorial on first visit
            if (!localStorage.getItem('webcraft_visited')) {
                document.getElementById('tutorialOverlay').classList.add('active');
                localStorage.setItem('webcraft_visited', 'true');
            }
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderComponents() {
            const grid = document.getElementById('componentsGrid');
            const mobileGrid = document.getElementById('mobileComponentGrid');
            
            ComponentLibrary.forEach(comp => {
                // Desktop card
                const card = document.createElement('div');
                card.className = 'component-card';
                card.draggable = true;
                card.dataset.type = comp.type;
                card.innerHTML = `
                    <div class="component-icon"><i class="fas ${comp.icon}"></i></div>
                    <span class="component-name">${comp.name}</span>
                `;
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('click', () => addElement(comp.type));
                grid.appendChild(card);
                
                // Mobile card
                const mobileCard = card.cloneNode(true);
                mobileCard.addEventListener('click', () => {
                    addElement(comp.type);
                    closeModal('componentPickerModal');
                });
                mobileGrid.appendChild(mobileCard);
            });
        }

        function renderTemplates() {
            const container = document.getElementById('templatesGrid');
            TemplateLibrary.forEach(tpl => {
                const card = document.createElement('div');
                card.className = 'template-card';
                card.onclick = () => loadTemplate(tpl.id);
                card.innerHTML = `
                    <div class="template-preview"><i class="fas ${tpl.icon}"></i></div>
                    <div class="template-info">
                        <div class="template-name">${tpl.name}</div>
                        <div class="template-desc">${tpl.desc}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderAssets() {
            const grid = document.getElementById('assetsGrid');
            
            // Icons
            AssetLibrary.icons.forEach(icon => {
                const item = document.createElement('div');
                item.className = 'asset-item';
                item.innerHTML = `<i class="fas ${icon}"></i>`;
                item.onclick = () => addIconAsset(icon);
                grid.appendChild(item);
            });
        }

        // ==================== ELEMENT MANAGEMENT ====================
        function addElement(type, parentId = null) {
            elementCounter++;
            const comp = ComponentLibrary.find(c => c.type === type) || ComponentLibrary[0];
            
            const element = {
                id: `el_${Date.now()}_${elementCounter}`,
                type: type,
                tag: comp.tag || 'div',
                content: getDefaultContent(type),
                attributes: getDefaultAttributes(type),
                styles: getDefaultStyles(type),
                children: [],
                parentId: parentId,
                scripts: [] // For visual blocks
            };

            if (parentId) {
                const parent = findElement(parentId);
                if (parent) parent.children.push(element);
            } else {
                AppState.elements.push(element);
            }

            saveState();
            renderCanvas();
            selectElement(element.id);
            showToast(`Added ${comp.name}`, 'success');
        }

        function getDefaultContent(type) {
            const defaults = {
                button: 'Click Me',
                h1: 'Heading 1',
                h2: 'Heading 2',
                h3: 'Heading 3',
                p: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
                a: 'Link',
                span: 'Text',
                label: 'Label'
            };
            return defaults[type] || '';
        }

        function getDefaultAttributes(type) {
            const attrs = {};
            if (type === 'input' || type === 'textarea') {
                attrs.placeholder = 'Enter text...';
                if (type === 'input') attrs.type = 'text';
            } else if (type === 'img') {
                attrs.src = 'https://via.placeholder.com/400x300';
                attrs.alt = 'Image';
            } else if (type === 'a') {
                attrs.href = '#';
            }
            return attrs;
        }

        function getDefaultStyles(type) {
            const styles = { margin: '0', padding: '0' };
            
            switch(type) {
                case 'button':
                    styles.padding = '12px 24px';
                    styles.backgroundColor = '#6366f1';
                    styles.color = '#ffffff';
                    styles.border = 'none';
                    styles.borderRadius = '8px';
                    styles.cursor = 'pointer';
                    styles.fontSize = '16px';
                    break;
                case 'h1':
                    styles.fontSize = '48px';
                    styles.fontWeight = 'bold';
                    styles.color = '#1f2937';
                    styles.marginBottom = '20px';
                    break;
                case 'h2':
                    styles.fontSize = '36px';
                    styles.fontWeight = 'bold';
                    styles.color = '#1f2937';
                    styles.marginBottom = '16px';
                    break;
                case 'h3':
                    styles.fontSize = '24px';
                    styles.fontWeight = 'bold';
                    styles.color = '#1f2937';
                    styles.marginBottom = '12px';
                    break;
                case 'p':
                    styles.fontSize = '16px';
                    styles.lineHeight = '1.6';
                    styles.color = '#4b5563';
                    styles.marginBottom = '16px';
                    break;
                case 'input':
                case 'textarea':
                    styles.padding = '12px';
                    styles.border = '2px solid #e5e7eb';
                    styles.borderRadius = '8px';
                    styles.fontSize = '16px';
                    styles.width = '100%';
                    break;
                case 'card':
                    styles.backgroundColor = '#ffffff';
                    styles.padding = '24px';
                    styles.borderRadius = '12px';
                    styles.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
                    break;
                case 'container':
                    styles.width = '100%';
                    styles.maxWidth = '1200px';
                    styles.margin = '0 auto';
                    styles.padding = '20px';
                    break;
            }
            
            return styles;
        }

        function findElement(id, arr = AppState.elements) {
            for (let el of arr) {
                if (el.id === id) return el;
                if (el.children.length > 0) {
                    const found = findElement(id, el.children);
                    if (found) return found;
                }
            }
            return null;
        }

        function renderCanvas() {
            const container = document.getElementById('canvasContent');
            
            if (AppState.elements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-plus-circle"></i></div>
                        <div class="empty-text">Start Building</div>
                        <div class="empty-subtext">
                            Tap AI Assistant or + to add components<br>
                            اسحب العناصر أو استخدم المعالج الذكي
                        </div>
                    </div>
                `;
                updateStats();
                return;
            }

            container.innerHTML = AppState.elements.map(el => renderElement(el)).join('');
            
            // Add event listeners
            AppState.elements.forEach(el => {
                const domEl = document.getElementById(el.id);
                if (domEl) {
                    domEl.addEventListener('click', (e) => {
                        e.stopPropagation();
                        selectElement(el.id);
                    });
                    
                    // Attach scripts
                    if (el.scripts && el.scripts.length > 0) {
                        attachScripts(domEl, el.scripts);
                    }
                }
            });

            updateStats();
        }

        function renderElement(el) {
            const styleString = Object.entries(el.styles)
                .map(([k, v]) => `${k.replace(/[A-Z]/g, m => '-' + m.toLowerCase())}: ${v}`)
                .join('; ');
            
            const attrString = Object.entries(el.attributes)
                .map(([k, v]) => `${k}="${v}"`)
                .join(' ');
            
            const isSelected = AppState.selectedId === el.id ? 'selected' : '';
            const hasScripts = el.scripts && el.scripts.length > 0 ? 'has-scripts' : '';
            
            let content = el.content;
            if (el.children.length > 0) {
                content = el.children.map(c => renderElement(c)).join('');
            }

            const selfClosing = ['img', 'input', 'br', 'hr'].includes(el.tag);
            
            let html = '';
            if (selfClosing) {
                html = `<${el.tag} id="${el.id}" class="canvas-element ${isSelected} ${hasScripts}" 
                        style="${styleString}" ${attrString} data-type="${el.type}">`;
            } else {
                html = `
                    <${el.tag} id="${el.id}" class="canvas-element ${isSelected} ${hasScripts}" 
                     style="${styleString}" ${attrString} data-type="${el.type}">
                        ${content}
                        ${isSelected ? `
                            <div class="element-actions">
                                <button class="action-btn edit" onclick="event.stopPropagation(); editElement()" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn code" onclick="event.stopPropagation(); editElementCode()" title="Code">
                                    <i class="fas fa-code"></i>
                                </button>
                                <button class="action-btn blocks" onclick="event.stopPropagation(); openScriptEditor('${el.id}')" title="Blocks">
                                    <i class="fas fa-cubes"></i>
                                </button>
                                <button class="action-btn duplicate" onclick="event.stopPropagation(); duplicateElement()" title="Duplicate">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="action-btn" onclick="event.stopPropagation(); deleteElement('${el.id}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        ` : ''}
                    </${el.tag}>
                `;
            }
            
            return html;
        }

        function attachScripts(element, scripts) {
            scripts.forEach(script => {
                if (script.event === 'onClick') {
                    element.addEventListener('click', () => executeScript(script.blocks));
                } else if (script.event === 'onLoad') {
                    window.addEventListener('load', () => executeScript(script.blocks));
                } else if (script.event === 'onHover') {
                    element.addEventListener('mouseenter', () => executeScript(script.blocks));
                }
            });
        }

        function executeScript(blocks) {
            blocks.forEach(block => {
                executeBlock(block);
            });
        }

        function executeBlock(block) {
            const target = block.params.target ? document.querySelector(block.params.target) : null;
            
            switch(block.id) {
                case 'showAlert':
                    alert(block.params.message || 'Alert!');
                    break;
                case 'showElement':
                    if (target) target.style.display = 'block';
                    break;
                case 'hideElement':
                    if (target) target.style.display = 'none';
                    break;
                case 'setText':
                    if (target) target.textContent = block.params.text || '';
                    break;
                case 'setStyle':
                    if (target) target.style[block.params.property] = block.params.value;
                    break;
                case 'redirect':
                    if (block.params.newTab === 'true') {
                        window.open(block.params.url, '_blank');
                    } else {
                        window.location.href = block.params.url;
                    }
                    break;
                case 'fadeIn':
                    if (target) {
                        target.style.opacity = '0';
                        target.style.transition = `opacity ${block.params.duration || 300}ms`;
                        setTimeout(() => target.style.opacity = '1', 10);
                    }
                    break;
                case 'fadeOut':
                    if (target) {
                        target.style.transition = `opacity ${block.params.duration || 300}ms`;
                        target.style.opacity = '0';
                    }
                    break;
                case 'setVariable':
                    window[block.params.name] = block.params.value;
                    break;
                case 'getVariable':
                    return window[block.params.name];
                case 'saveLocalStorage':
                    localStorage.setItem(block.params.key, block.params.value);
                    break;
                case 'loadLocalStorage':
                    return localStorage.getItem(block.params.key);
                case 'fetchGet':
                    fetch(block.params.url)
                        .then(r => r.json())
                        .then(data => window[block.params.variable || 'response'] = data);
                    break;
            }
        }

        // ==================== SELECTION & PROPERTIES ====================
        function selectElement(id) {
            AppState.selectedId = id;
            renderCanvas();
            renderProperties();
            
            if (window.innerWidth <= 768) {
                document.getElementById('sidebarRight').classList.add('active');
            }
        }

        function renderProperties() {
            const container = document.getElementById('propertiesContent');
            
            if (!AppState.selectedId) {
                container.innerHTML = `
                    <div class="empty-state" style="padding:40px 20px;">
                        <i class="fas fa-mouse-pointer" style="font-size:32px; margin-bottom:10px; opacity:0.5;"></i>
                        <p style="font-size:14px;">Select an element to edit<br>اختر عنصر للتعديل</p>
                    </div>
                `;
                return;
            }

            const el = findElement(AppState.selectedId);
            if (!el) return;

            container.innerHTML = `
                <div class="prop-group">
                    <label class="prop-label">Element Type</label>
                    <input type="text" class="prop-input" value="${el.type}" readonly>
                </div>
                
                <div class="prop-group">
                    <label class="prop-label">ID</label>
                    <input type="text" class="prop-input" value="${el.id}" readonly>
                </div>

                ${el.tag !== 'input' && el.tag !== 'img' ? `
                <div class="prop-group">
                    <label class="prop-label">Content / Text</label>
                    <input type="text" class="prop-input" value="${el.content}" 
                           onchange="updateElement('content', this.value)">
                </div>
                ` : ''}

                <div class="section-title">Attributes</div>
                ${renderAttributesEditor(el)}

                <div class="section-title">Styles</div>
                
                <div class="prop-group">
                    <label class="prop-label">Background Color</label>
                    <div class="color-input-wrapper">
                        <input type="color" class="color-input" 
                               value="${rgbToHex(el.styles.backgroundColor) || '#ffffff'}" 
                               onchange="updateStyle('backgroundColor', this.value)">
                        <input type="text" class="prop-input" 
                               value="${el.styles.backgroundColor || ''}" 
                               onchange="updateStyle('backgroundColor', this.value)">
                    </div>
                </div>

                <div class="prop-group">
                    <label class="prop-label">Text Color</label>
                    <div class="color-input-wrapper">
                        <input type="color" class="color-input" 
                               value="${rgbToHex(el.styles.color) || '#000000'}" 
                               onchange="updateStyle('color', this.value)">
                        <input type="text" class="prop-input" 
                               value="${el.styles.color || ''}" 
                               onchange="updateStyle('color', this.value)">
                    </div>
                </div>

                <div class="prop-row">
                    <div class="prop-group">
                        <label class="prop-label">Font Size</label>
                        <input type="text" class="prop-input" 
                               value="${el.styles.fontSize || ''}" 
                               onchange="updateStyle('fontSize', this.value)">
                    </div>
                    <div class="prop-group">
                        <label class="prop-label">Padding</label>
                        <input type="text" class="prop-input" 
                               value="${el.styles.padding || ''}" 
                               onchange="updateStyle('padding', this.value)">
                    </div>
                </div>

                <div class="prop-row">
                    <div class="prop-group">
                        <label class="prop-label">Margin</label>
                        <input type="text" class="prop-input" 
                               value="${el.styles.margin || ''}" 
                               onchange="updateStyle('margin', this.value)">
                    </div>
                    <div class="prop-group">
                        <label class="prop-label">Border Radius</label>
                        <input type="text" class="prop-input" 
                               value="${el.styles.borderRadius || ''}" 
                               onchange="updateStyle('borderRadius', this.value)">
                    </div>
                </div>

                <div class="prop-group">
                    <label class="prop-label">Custom CSS</label>
                    <textarea class="prop-input" rows="3" placeholder="property: value;"
                              onchange="applyCustomStyles(this.value)"></textarea>
                </div>

                <div class="section-title">Quick Styles</div>
                <div class="style-buttons">
                    <button class="style-btn" onclick="toggleStyle('fontWeight', 'bold')">Bold</button>
                    <button class="style-btn" onclick="toggleStyle('fontStyle', 'italic')">Italic</button>
                    <button class="style-btn" onclick="toggleStyle('textDecoration', 'underline')">Underline</button>
                    <button class="style-btn" onclick="updateStyle('textAlign', 'left')">Left</button>
                    <button class="style-btn" onclick="updateStyle('textAlign', 'center')">Center</button>
                    <button class="style-btn" onclick="updateStyle('textAlign', 'right')">Right</button>
                </div>

                ${el.scripts && el.scripts.length > 0 ? `
                <div class="section-title">Attached Scripts (${el.scripts.length})</div>
                <div class="prop-group">
                    ${el.scripts.map((s, i) => `
                        <div style="padding:10px; background:var(--dark); border-radius:6px; margin-bottom:8px; font-size:12px;">
                            <i class="fas fa-bolt" style="color:var(--block-event);"></i> 
                            ${s.event} → ${s.blocks.length} blocks
                            <button onclick="removeScript(${i})" style="float:right; color:var(--danger); background:none; border:none; cursor:pointer;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="section-title">Actions</div>
                <button class="btn btn-primary" style="width:100%; margin-bottom:10px;" onclick="openScriptEditor('${el.id}')">
                    <i class="fas fa-cubes"></i> Add Behavior (Blocks)
                </button>
                <button class="btn btn-secondary" style="width:100%; margin-bottom:10px;" onclick="editElementCode()">
                    <i class="fas fa-code"></i> Edit HTML/CSS
                </button>
                <button class="btn btn-danger" style="width:100%;" onclick="deleteSelected()">
                    <i class="fas fa-trash"></i> Delete Element
                </button>
            `;
        }

        function renderAttributesEditor(el) {
            const attrs = Object.entries(el.attributes);
            if (attrs.length === 0) return '<p style="color:var(--gray); font-size:12px;">No attributes</p>';
            
            return attrs.map(([key, val]) => `
                <div class="prop-row" style="margin-bottom:8px;">
                    <input type="text" class="prop-input" value="${key}" readonly style="flex:1;">
                    <input type="text" class="prop-input" value="${val}" 
                           onchange="updateAttribute('${key}', this.value)" style="flex:2;">
                </div>
            `).join('');
        }

        function updateElement(prop, value) {
            const el = findElement(AppState.selectedId);
            if (el) {
                el[prop] = value;
                saveState();
                renderCanvas();
            }
        }

        function updateAttribute(key, value) {
            const el = findElement(AppState.selectedId);
            if (el) {
                el.attributes[key] = value;
                saveState();
                renderCanvas();
            }
        }

        function updateStyle(prop, value) {
            const el = findElement(AppState.selectedId);
            if (el) {
                el.styles[prop] = value;
                saveState();
                renderCanvas();
            }
        }

        function toggleStyle(prop, value) {
            const el = findElement(AppState.selectedId);
            if (el) {
                if (el.styles[prop] === value) {
                    delete el.styles[prop];
                } else {
                    el.styles[prop] = value;
                }
                saveState();
                renderCanvas();
            }
        }

        function applyCustomStyles(cssText) {
            const el = findElement(AppState.selectedId);
            if (!el || !cssText) return;
            
            cssText.split(';').forEach(decl => {
                const [prop, val] = decl.split(':').map(s => s.trim());
                if (prop && val) {
                    const camelProp = prop.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                    el.styles[camelProp] = val;
                }
            });
            saveState();
            renderCanvas();
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb.startsWith('#')) return rgb;
            const match = rgb.match(/\d+/g);
            if (!match) return '#000000';
            return '#' + match.map(x => {
                const hex = parseInt(x).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        // ==================== AI ASSISTANT ====================
        function toggleAIChat() {
            const panel = document.getElementById('aiChatPanel');
            panel.classList.toggle('active');
        }

        function processAICommand() {
            const input = document.getElementById('aiInput').value.trim();
            if (!input) return;
            
            // Detect language
            const lang = detectLanguage(input);
            
            // Show loading
            showToast('AI is generating...', 'info');
            
            // Generate response
            setTimeout(() => {
                const result = AISystem.generateResponse(input, lang);
                
                // Clear current elements
                AppState.elements = [];
                elementCounter = 0;
                
                // Add generated elements
                result.elements.forEach(el => {
                    elementCounter++;
                    const newEl = {
                        ...el,
                        id: `el_${Date.now()}_${elementCounter}`
                    };
                    AppState.elements.push(newEl);
                });
                
                saveState();
                renderCanvas();
                
                // Show success message
                showToast(`Generated: ${result.description}`, 'success');
                
                // Add suggestions to chat
                addAIMessage(`Created ${result.elements.length} elements. Suggestions: ${result.suggestions.join(', ')}`);
                
                // Clear input
                document.getElementById('aiInput').value = '';
            }, 1500);
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addUserMessage(message);
            input.value = '';
            
            // Process command
            const lang = detectLanguage(message);
            const result = AISystem.generateResponse(message, lang);
            
            setTimeout(() => {
                if (result.elements.length > 0) {
                    AppState.elements = [];
                    elementCounter = 0;
                    result.elements.forEach(el => {
                        elementCounter++;
                        AppState.elements.push({
                            ...el,
                            id: `el_${Date.now()}_${elementCounter}`
                        });
                    });
                    saveState();
                    renderCanvas();
                    addAIMessage(`✅ Created ${result.description} with ${result.elements.length} elements!`);
                } else {
                    addAIMessage("I can help you build: todo apps, login forms, dashboards, shops, blogs, portfolios, landing pages, and more! Just describe what you need in any language.");
                }
            }, 1000);
        }

        function detectLanguage(text) {
            // Simple detection based on character ranges
            if (/[\u0600-\u06FF]/.test(text)) return 'ar'; // Arabic
            if (/[\u4E00-\u9FFF]/.test(text)) return 'zh'; // Chinese
            if (/[\u3040-\u309F\u30A0-\u30FF]/.test(text)) return 'ja'; // Japanese
            if (/[\uAC00-\uD7AF]/.test(text)) return 'ko'; // Korean
            if (/[а-яА-Я]/.test(text)) return 'ru'; // Russian
            if (/[áéíóúñ¿¡]/.test(text)) return 'es'; // Spanish
            return 'en'; // Default English
        }

        function addUserMessage(text) {
            const container = document.getElementById('aiChatMessages');
            const div = document.createElement('div');
            div.className = 'ai-message user-message';
            div.innerHTML = `
                <div class="ai-bubble user-bubble">${text}</div>
                <div class="ai-avatar" style="background:var(--primary);"><i class="fas fa-user"></i></div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addAIMessage(text) {
            const container = document.getElementById('aiChatMessages');
            const div = document.createElement('div');
            div.className = 'ai-message';
            div.innerHTML = `
                <div class="ai-avatar"><i class="fas fa-robot"></i></div>
                <div class="ai-bubble">${text}</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // ==================== VISUAL BLOCKS EDITOR ====================
        function openScriptEditor(elementId) {
            AppState.currentScriptElement = elementId;
            const el = findElement(elementId);
            document.getElementById('scriptTarget').textContent = el ? el.type : 'Element';
            document.getElementById('scriptOverlay').classList.add('active');
            
            // Render existing scripts
            renderDroppedBlocks();
        }

        function closeScriptEditor() {
            document.getElementById('scriptOverlay').classList.remove('active');
            AppState.currentScriptElement = null;
        }

        function saveScript() {
            const workspace = document.getElementById('droppedBlocks');
            const blocks = [];
            
            workspace.querySelectorAll('.dropped-block').forEach(blockEl => {
                const blockId = blockEl.dataset.blockId;
                const blockType = blockEl.dataset.blockType;
                const params = {};
                
                blockEl.querySelectorAll('.block-input').forEach(input => {
                    params[input.dataset.param] = input.value;
                });
                
                blocks.push({ id: blockId, type: blockType, params });
            });
            
            if (AppState.currentScriptElement && blocks.length > 0) {
                const el = findElement(AppState.currentScriptElement);
                if (el) {
                    if (!el.scripts) el.scripts = [];
                    el.scripts.push({
                        event: 'onClick', // Default event
                        blocks: blocks
                    });
                    saveState();
                    renderCanvas();
                    showToast('Behavior saved!', 'success');
                }
            }
            
            closeScriptEditor();
        }

        function renderDroppedBlocks() {
            const container = document.getElementById('droppedBlocks');
            const el = findElement(AppState.currentScriptElement);
            
            if (el && el.scripts && el.scripts.length > 0) {
                container.innerHTML = el.scripts.map((script, idx) => `
                    <div style="margin-bottom:20px; padding:15px; background:var(--dark); border-radius:8px;">
                        <div style="color:var(--block-event); font-weight:600; margin-bottom:10px;">
                            <i class="fas fa-bolt"></i> ${script.event}
                        </div>
                        ${script.blocks.map(block => renderBlockPreview(block)).join('')}
                    </div>
                `).join('');
            } else {
                container.innerHTML = `
                    <div style="text-align:center; color:var(--gray); padding:40px;">
                        <i class="fas fa-hand-pointer" style="font-size:32px; margin-bottom:15px;"></i>
                        <p>Drag blocks here from the left panel<br>اسحب البلوكات من اليسار</p>
                    </div>
                `;
            }
        }

        function renderBlockPreview(block) {
            const colors = {
                event: 'var(--block-event)',
                action: 'var(--block-action)',
                logic: 'var(--block-logic)',
                data: 'var(--block-data)',
                api: 'var(--block-api)',
                anim: 'var(--block-anim)'
            };
            
            return `
                <div style="padding:10px; background:${colors[block.type] || colors.action}; 
                            color:white; border-radius:6px; margin-bottom:8px; font-size:12px;">
                    <i class="fas fa-cube"></i> ${block.id}
                </div>
            `;
        }

        // ==================== DRAG AND DROP ====================
        function initDragAndDrop() {
            const workspace = document.getElementById('scriptWorkspace');
            
            workspace.addEventListener('dragover', (e) => {
                e.preventDefault();
                workspace.classList.add('drag-over');
            });
            
            workspace.addEventListener('dragleave', () => {
                workspace.classList.remove('drag-over');
            });
            
            workspace.addEventListener('drop', (e) => {
                e.preventDefault();
                workspace.classList.remove('drag-over');
                
                const blockId = e.dataTransfer.getData('blockId');
                const blockType = e.dataTransfer.getData('blockType');
                
                if (blockId && blockType) {
                    addDroppedBlock(blockId, blockType);
                }
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('blockId', e.target.dataset.block);
            e.dataTransfer.setData('blockType', e.target.dataset.type);
        }

        function addDroppedBlock(blockId, blockType) {
            const container = document.getElementById('droppedBlocks');
            
            // Clear placeholder if first block
            if (container.querySelector('.dropped-block') === null) {
                container.innerHTML = '';
            }
            
            const blockDef = findBlockDefinition(blockId, blockType);
            if (!blockDef) return;
            
            const blockEl = document.createElement('div');
            blockEl.className = `dropped-block ${blockType}`;
            blockEl.dataset.blockId = blockId;
            blockEl.dataset.blockType = blockType;
            blockEl.draggable = true;
            
            let inputsHtml = '';
            if (blockDef.params) {
                inputsHtml = blockDef.params.map(param => `
                    <input type="${param.type === 'number' ? 'number' : 'text'}" 
                           class="block-input" 
                           data-param="${param.name}"
                           placeholder="${param.name}"
                           value="${param.default || ''}"
                           style="${param.type === 'textarea' ? 'width:100%; min-height:60px;' : ''}">
                `).join('');
            }
            
            blockEl.innerHTML = `
                <i class="fas ${blockDef.icon}"></i>
                <span>${blockDef.name}</span>
                <div class="block-config">
                    ${inputsHtml}
                    <button onclick="this.parentElement.parentElement.remove()" style="background:none; border:none; color:white; cursor:pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(blockEl);
        }

        function findBlockDefinition(id, type) {
            const collection = BlockDefinitions[type + 's'];
            return collection ? collection.find(b => b.id === id) : null;
        }

        function toggleBlocks(category) {
            const list = document.getElementById(category + 'Blocks');
            list.style.display = list.style.display === 'none' ? 'grid' : 'none';
        }

        // ==================== CODE EDITOR ====================
        function initCodeEditor() {
            // Initialize CodeMirror when editor opens
        }

        function openCodeEditor() {
            document.getElementById('codeEditorModal').classList.add('active');
            generateAllCode();
            
            // Initialize CodeMirror
            if (!codeEditorInstance) {
                codeEditorInstance = CodeMirror.fromTextArea(document.getElementById('codeTextarea'), {
                    mode: 'htmlmixed',
                    theme: 'dracula',
                    lineNumbers: true,
                    autoCloseTags: true,
                    autoCloseBrackets: true,
                    matchBrackets: true,
                    indentUnit: 2,
                    tabSize: 2,
                    lineWrapping: true
                });
            }
            
            updateCodePreview();
        }

        function closeCodeEditor() {
            document.getElementById('codeEditorModal').classList.remove('active');
        }

        function switchCodeTab(tab) {
            document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const modes = {
                'html': 'htmlmixed',
                'css': 'css',
                'js': 'javascript',
                'react': 'jsx',
                'vue': 'htmlmixed',
                'full': 'htmlmixed'
            };
            
            if (codeEditorInstance && modes[tab]) {
                codeEditorInstance.setOption('mode', modes[tab]);
            }
            
            document.getElementById('editorPane').style.display = tab === 'full' ? 'none' : 'flex';
            document.getElementById('previewPane').style.display = 'flex';
            
            generateCodeForTab(tab);
        }

        function generateAllCode() {
            const html = generateHTML();
            if (codeEditorInstance) {
                codeEditorInstance.setValue(html);
            }
        }

        function generateCodeForTab(tab) {
            let code = '';
            switch(tab) {
                case 'html':
                    code = generateHTML();
                    break;
                case 'css':
                    code = generateCSS();
                    break;
                case 'js':
                    code = generateJS();
                    break;
                case 'react':
                    code = generateReact();
                    break;
                case 'vue':
                    code = generateVue();
                    break;
                case 'full':
                    code = generateFullPage();
                    break;
            }
            
            if (codeEditorInstance) {
                codeEditorInstance.setValue(code);
            }
        }

        function generateHTML() {
            return AppState.elements.map(el => generateElementHTML(el, 0)).join('\n');
        }

        function generateElementHTML(el, indent) {
            const spaces = '  '.repeat(indent);
            const style = Object.entries(el.styles)
                .map(([k, v]) => `${k.replace(/[A-Z]/g, m => '-' + m.toLowerCase())}: ${v}`)
                .join('; ');
            const attrs = Object.entries(el.attributes)
                .map(([k, v]) => `${k}="${v}"`)
                .join(' ');
            
            const selfClosing = ['img', 'input', 'br', 'hr'].includes(el.tag);
            const styleAttr = style ? ` style="${style}"` : '';
            const attrStr = attrs ? ' ' + attrs : '';
            const idAttr = ` id="${el.id}"`;
            
            if (selfClosing) {
                return `${spaces}<${el.tag}${idAttr}${styleAttr}${attrStr}>`;
            }
            
            const content = el.children.length > 0 
                ? '\n' + el.children.map(c => generateElementHTML(c, indent + 1)).join('\n') + '\n' + spaces
                : el.content;
                
            return `${spaces}<${el.tag}${idAttr}${styleAttr}${attrStr}>${content}</${el.tag}>`;
        }

        function generateCSS() {
            let css = '/* Generated CSS */\n\n';
            
            AppState.elements.forEach(el => {
                const selector = `#${el.id}`;
                const rules = Object.entries(el.styles)
                    .map(([k, v]) => `  ${k.replace(/[A-Z]/g, m => '-' + m.toLowerCase())}: ${v};`)
                    .join('\n');
                
                if (rules) {
                    css += `${selector} {\n${rules}\n}\n\n`;
                }
            });
            
            return css;
        }

        function generateJS() {
            let js = '// Generated JavaScript\n\n';
            
            // Add event listeners for elements with scripts
            AppState.elements.forEach(el => {
                if (el.scripts && el.scripts.length > 0) {
                    js += `// Scripts for #${el.id}\n`;
                    js += `document.getElementById('${el.id}').addEventListener('click', function() {\n`;
                    
                    el.scripts.forEach(script => {
                        script.blocks.forEach(block => {
                            js += `  // ${block.id}\n`;
                            js += generateBlockJS(block, 1);
                        });
                    });
                    
                    js += '});\n\n';
                }
            });
            
            return js || '// No interactive elements yet';
        }

        function generateBlockJS(block, indent) {
            const spaces = '  '.repeat(indent);
            let code = '';
            
            switch(block.id) {
                case 'showAlert':
                    code += `${spaces}alert('${block.params.message || 'Alert'}');\n`;
                    break;
                case 'showElement':
                    code += `${spaces}document.querySelector('${block.params.target}').style.display = 'block';\n`;
                    break;
                case 'hideElement':
                    code += `${spaces}document.querySelector('${block.params.target}').style.display = 'none';\n`;
                    break;
                case 'setText':
                    code += `${spaces}document.querySelector('${block.params.target}').textContent = '${block.params.text}';\n`;
                    break;
                case 'redirect':
                    code += `${spaces}window.location.href = '${block.params.url}';\n`;
                    break;
            }
            
            return code;
        }

        function generateReact() {
            return `import React from 'react';

export default function App() {
  return (
    <div className="app">
${AppState.elements.map(el => generateReactElement(el, 3)).join('\n')}
    </div>
  );
}`;
        }

        function generateReactElement(el, indent) {
            const spaces = ' '.repeat(indent);
            const props = [];
            
            if (Object.keys(el.styles).length > 0) {
                const styleObj = JSON.stringify(el.styles).replace(/"/g, "'");
                props.push(`style={${styleObj}}`);
            }
            
            Object.entries(el.attributes).forEach(([k, v]) => {
                if (k === 'class') props.push(`className="${v}"`);
                else props.push(`${k}="${v}"`);
            });
            
            props.push(`id="${el.id}"`);
            
            const propStr = props.length ? ' ' + props.join(' ') : '';
            const selfClosing = ['img', 'input'].includes(el.tag);
            
            if (selfClosing) return `${spaces}<${el.tag}${propStr} />`;
            
            const content = el.children.length > 0
                ? '\n' + el.children.map(c => generateReactElement(c, indent + 2)).join('\n') + '\n' + spaces
                : el.content || '';
                
            return `${spaces}<${el.tag}${propStr}>${content}</${el.tag}>`;
        }

        function generateVue() {
            return `<template>
  <div class="app">
${AppState.elements.map(el => generateVueElement(el, 2)).join('\n')}
  </div>
</template>

<script>
export default {
  name: 'App'
}
<\/script>

<style>
${generateCSS()}
</style>`;
        }

        function generateVueElement(el, indent) {
            const spaces = '  '.repeat(indent);
            const style = Object.entries(el.styles)
                .map(([k, v]) => `${k.replace(/[A-Z]/g, m => '-' + m.toLowerCase())}: ${v}`)
                .join('; ');
            const attrs = Object.entries(el.attributes)
                .map(([k, v]) => `${k}="${v}"`)
                .join(' ');
            
            const styleAttr = style ? ` style="${style}"` : '';
            const attrStr = attrs ? ' ' + attrs : '';
            const idAttr = ` id="${el.id}"`;
            
            const selfClosing = ['img', 'input'].includes(el.tag);
            if (selfClosing) return `${spaces}<${el.tag}${idAttr}${styleAttr}${attrStr} />`;
            
            const content = el.children.length > 0
                ? '\n' + el.children.map(c => generateVueElement(c, indent + 1)).join('\n') + '\n' + spaces
                : el.content;
                
            return `${spaces}<${el.tag}${idAttr}${styleAttr}${attrStr}>${content}</${el.tag}>`;
        }

        function generateFullPage() {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated App</title>
    <style>
${generateCSS()}
    </style>
</head>
<body>
${generateHTML()}
    <script>
${generateJS()}
    <\/script>
</body>
</html>`;
        }

        function updateCodePreview() {
            const code = codeEditorInstance ? codeEditorInstance.getValue() : generateFullPage();
            const frame = document.getElementById('previewFrame');
            frame.srcdoc = code;
        }

        function refreshPreview() {
            updateCodePreview();
            showToast('Preview refreshed', 'success');
        }

        function openInNewTab() {
            const code = generateFullPage();
            const blob = new Blob([code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        function formatCode() {
            // Simple formatting
            const code = codeEditorInstance.getValue();
            // Add basic indentation (simplified)
            showToast('Code formatted', 'success');
        }

        function applyCodeChanges() {
            showToast('Changes applied', 'success');
            closeCodeEditor();
        }

        function editElementCode() {
            openCodeEditor();
            // Could focus on specific element code
        }

        // ==================== EXPORT ====================
        function openExportModal() {
            document.getElementById('exportModal').classList.add('active');
            
            // Generate QR code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, {
                text: window.location.href,
                width: 128,
                height: 128
            });
        }

        async function exportProject(type) {
            const name = prompt('Project name:', 'my-app') || 'my-app';
            const zip = new JSZip();
            
            switch(type) {
                case 'html':
                    zip.file('index.html', generateFullPage());
                    break;
                case 'react':
                    zip.file('src/App.js', generateReact());
                    zip.file('src/index.js', `import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);`);
                    zip.file('public/index.html', `<!DOCTYPE html>
<html>
<head><title>${name}</title></head>
<body><div id="root"></div></body>
</html>`);
                    break;
                case 'vue':
                    zip.file('src/App.vue', generateVue());
                    break;
                case 'next':
                    zip.file('pages/index.js', `export default function Home() {
  return (
    <div>
${generateHTML()}
    </div>
  );
}`);
                    break;
                case 'angular':
                    zip.file('src/app/app.component.html', generateHTML());
                    break;
                case 'svelte':
                    zip.file('src/App.svelte', generateHTML());
                    break;
            }
            
            const content = await zip.generateAsync({type: 'blob'});
            saveAs(content, `${name}.zip`);
            closeModal('exportModal');
            showToast('Project exported!', 'success');
        }

        // ==================== PREVIEW MODE ====================
        function togglePreviewMode() {
            const overlay = document.getElementById('previewModeOverlay');
            const frame = document.getElementById('previewModeFrame');
            
            overlay.classList.add('active');
            frame.srcdoc = generateFullPage();
        }

        function exitPreviewMode() {
            document.getElementById('previewModeOverlay').classList.remove('active');
        }

        // ==================== TEMPLATES ====================
        function loadTemplate(templateId) {
            if (!confirm('Load template? This will replace current content.')) return;
            
            const templateData = getTemplateData(templateId);
            AppState.elements = JSON.parse(JSON.stringify(templateData));
            
            // Reassign IDs
            let counter = 0;
            const assignIds = (arr) => {
                arr.forEach(el => {
                    el.id = `el_${Date.now()}_${++counter}`;
                    if (el.children) assignIds(el.children);
                });
            };
            assignIds(AppState.elements);
            elementCounter = counter;
            
            saveState();
            renderCanvas();
            showToast(`Loaded ${templateId} template`, 'success');
        }

        function getTemplateData(id) {
            return AISystem.generateResponse(id, 'en').elements;
        }

        // ==================== HISTORY ====================
        function saveState() {
            AppState.history = AppState.history.slice(0, AppState.historyIndex + 1);
            AppState.history.push(JSON.parse(JSON.stringify(AppState.elements)));
            AppState.historyIndex++;
            
            if (AppState.history.length > 50) {
                AppState.history.shift();
                AppState.historyIndex--;
            }
            
            localStorage.setItem('webcraft_project', JSON.stringify({
                elements: AppState.elements,
                timestamp: new Date().toISOString()
            }));
        }

        function undo() {
            if (AppState.historyIndex > 0) {
                AppState.historyIndex--;
                AppState.elements = JSON.parse(JSON.stringify(AppState.history[AppState.historyIndex]));
                renderCanvas();
                showToast('Undo', 'info');
            }
        }

        function redo() {
            if (AppState.historyIndex < AppState.history.length - 1) {
                AppState.historyIndex++;
                AppState.elements = JSON.parse(JSON.stringify(AppState.history[AppState.historyIndex]));
                renderCanvas();
                showToast('Redo', 'info');
            }
        }

        // ==================== UI HELPERS ====================
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function setDevice(device) {
            AppState.device = device;
            document.querySelectorAll('.device-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('canvas').className = 'canvas ' + device;
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            AppState.theme = AppState.theme === 'dark' ? 'light' : 'dark';
        }

        function toggleSidebarLeft() {
            document.getElementById('sidebarLeft').classList.toggle('active');
        }

        function toggleSidebarRight() {
            document.getElementById('sidebarRight').classList.toggle('active');
        }

        function showMobileTab(tab) {
            document.querySelectorAll('.bottom-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const sidebar = document.getElementById('sidebarLeft');
            sidebar.classList.add('active');
            
            // Switch to appropriate tab
            const tabMap = { 'components': 'components', 'blocks': 'blocks', 'templates': 'templates' };
            if (tabMap[tab]) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.querySelector(`.tab[onclick="switchTab('${tabMap[tab]}')"]`).classList.add('active');
                document.getElementById(tabMap[tab] + 'Tab').classList.add('active');
            }
        }

        function showComponentPicker() {
            document.getElementById('componentPickerModal').classList.add('active');
        }

        function toggleMobileProperties() {
            const panel = document.getElementById('sidebarRight');
            panel.classList.toggle('active');
            if (panel.classList.contains('active') && !AppState.selectedId) {
                showToast('Select an element first', 'info');
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function searchComponents(query) {
            const cards = document.querySelectorAll('.component-card');
            cards.forEach(card => {
                const name = card.querySelector('.component-name').textContent.toLowerCase();
                card.style.display = name.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function toggleGrid() {
            document.getElementById('canvas').classList.toggle('show-grid');
        }

        function clearCanvas() {
            if (!confirm('Clear all elements?')) return;
            AppState.elements = [];
            AppState.selectedId = null;
            saveState();
            renderCanvas();
            showToast('Canvas cleared', 'info');
        }

        // ==================== ELEMENT ACTIONS ====================
        function editElement() {
            // Focus on properties panel
            document.getElementById('sidebarRight').classList.add('active');
        }

        function duplicateElement() {
            if (!AppState.selectedId) return;
            const el = findElement(AppState.selectedId);
            if (!el) return;
            
            const copy = JSON.parse(JSON.stringify(el));
            copy.id = `el_${Date.now()}_${++elementCounter}`;
            
            // Find parent or add to root
            const parent = findParentElement(AppState.selectedId);
            if (parent) {
                parent.children.push(copy);
            } else {
                const index = AppState.elements.findIndex(e => e.id === AppState.selectedId);
                AppState.elements.splice(index + 1, 0, copy);
            }
            
            saveState();
            renderCanvas();
            selectElement(copy.id);
            showToast('Duplicated', 'success');
        }

        function findParentElement(childId, arr = AppState.elements) {
            for (let el of arr) {
                if (el.children.find(c => c.id === childId)) return el;
                const found = findParentElement(childId, el.children);
                if (found) return found;
            }
            return null;
        }

        function copyElement() {
            if (AppState.selectedId) {
                const el = findElement(AppState.selectedId);
                AppState.clipboard = JSON.parse(JSON.stringify(el));
                showToast('Copied', 'success');
            }
        }

        function pasteElement() {
            if (AppState.clipboard) {
                const copy = JSON.parse(JSON.stringify(AppState.clipboard));
                copy.id = `el_${Date.now()}_${++elementCounter}`;
                AppState.elements.push(copy);
                saveState();
                renderCanvas();
                showToast('Pasted', 'success');
            }
        }

        function moveElementUp() {
            // Implementation for moving element up
            showToast('Moved up', 'success');
        }

        function moveElementDown() {
            // Implementation for moving element down
            showToast('Moved down', 'success');
        }

        function deleteElement(id) {
            const index = AppState.elements.findIndex(el => el.id === id);
            if (index > -1) {
                AppState.elements.splice(index, 1);
            } else {
                AppState.elements.forEach(el => {
                    const childIndex = el.children.findIndex(c => c.id === id);
                    if (childIndex > -1) el.children.splice(childIndex, 1);
                });
            }
            
            if (AppState.selectedId === id) {
                AppState.selectedId = null;
            }
            
            saveState();
            renderCanvas();
            renderProperties();
        }

        function deleteSelected() {
            if (AppState.selectedId) {
                deleteElement(AppState.selectedId);
                showToast('Deleted', 'info');
            }
        }

        function removeScript(index) {
            const el = findElement(AppState.selectedId);
            if (el && el.scripts) {
                el.scripts.splice(index, 1);
                saveState();
                renderProperties();
                renderCanvas();
            }
        }

        function addIconAsset(iconClass) {
            addElement('span');
            setTimeout(() => {
                const el = findElement(AppState.selectedId);
                if (el) {
                    el.content = `<i class="fas ${iconClass}"></i>`;
                    saveState();
                    renderCanvas();
                }
            }, 0);
        }

        // ==================== TOUCH & MOBILE ====================
        function initTouchEvents() {
            let touchStartX = 0;
            let touchStartY = 0;
            
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchStartX - touchEndX;
                const diffY = touchStartY - touchEndY;
                
                // Swipe detection for sidebar
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 100) {
                    if (diffX > 0) {
                        // Swipe left - close sidebars
                        document.getElementById('sidebarLeft').classList.remove('active');
                        document.getElementById('sidebarRight').classList.remove('active');
                    } else {
                        // Swipe right - open left sidebar
                        document.getElementById('sidebarLeft').classList.add('active');
                    }
                }
            });
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'z':
                            e.preventDefault();
                            undo();
                            break;
                        case 'y':
                            e.preventDefault();
                            redo();
                            break;
                        case 's':
                            e.preventDefault();
                            saveToStorage();
                            break;
                        case 'd':
                            e.preventDefault();
                            duplicateElement();
                            break;
                        case 'p':
                            e.preventDefault();
                            togglePreviewMode();
                            break;
                    }
                } else if ((e.key === 'Delete' || e.key === 'Backspace') && AppState.selectedId) {
                    if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                        deleteSelected();
                    }
                }
            });
        }

        // ==================== CONTEXT MENU ====================
        function initContextMenu() {
            const menu = document.getElementById('contextMenu');
            
            document.addEventListener('contextmenu', (e) => {
                if (e.target.closest('.canvas-element')) {
                    e.preventDefault();
                    menu.style.display = 'block';
                    menu.style.left = e.pageX + 'px';
                    menu.style.top = e.pageY + 'px';
                }
            });
            
            document.addEventListener('click', () => {
                menu.style.display = 'none';
            });
        }

        // ==================== STORAGE ====================
        function saveToStorage() {
            localStorage.setItem('webcraft_project', JSON.stringify({
                elements: AppState.elements,
                timestamp: new Date().toISOString()
            }));
            showToast('Saved', 'success');
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('webcraft_project');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    AppState.elements = data.elements || [];
                    saveState();
                    renderCanvas();
                } catch(e) {
                    console.error('Failed to load saved project');
                }
            }
        }

        // ==================== STATS ====================
        function updateStats() {
            document.getElementById('elementCount').textContent = AppState.elements.length;
            
            // Calculate code lines
            const html = generateHTML();
            const lines = html.split('\n').length;
            document.getElementById('codeLines').textContent = lines;
        }

        // ==================== TOAST ====================
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            const colors = {
                success: 'var(--success)',
                error: 'var(--danger)',
                info: 'var(--primary)',
                warning: 'var(--warning)'
            };
            
            toast.style.borderLeftColor = colors[type] || colors.info;
            
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                info: 'info-circle',
                warning: 'exclamation-triangle'
            };
            
            toast.innerHTML = `<i class="fas fa-${icons[type]}"></i> ${message}`;
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        // ==================== TUTORIAL ====================
        function closeTutorial() {
            document.getElementById('tutorialOverlay').classList.remove('active');
        }

        // Initialize first state
        saveState();
    </script>
</body>
</html>
